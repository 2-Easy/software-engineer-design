# 乒乓球培训管理系统 - 软件结构图设计

## 1. 系统架构概述

乒乓球培训管理系统采用分层架构设计，包括表示层、业务逻辑层、数据访问层和数据层，支持Web端和移动端访问。

## 2. 总体系统架构

```
                    乒乓球培训管理系统总体架构

    ┌─────────────────────────────────────────────────────────────┐
    │                      表示层 (Presentation Layer)            │
    ├─────────────────────────────────────────────────────────────┤
    │  Web前端        │  移动端App       │  管理后台              │
    │  - 学员界面     │  - 学员端        │  - 校区管理界面        │
    │  - 教练界面     │  - 教练端        │  - 超级管理员界面      │
    │  - 登录注册     │  - 消息推送      │  - 系统监控界面        │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                    业务逻辑层 (Business Logic Layer)        │
    ├─────────────────────────────────────────────────────────────┤
    │                        API网关服务                         │
    ├─────────────────┬─────────────┬─────────────┬─────────────────┤
    │  用户管理服务   │ 预约管理服务 │ 收费管理服务 │  比赛管理服务   │
    ├─────────────────┼─────────────┼─────────────┼─────────────────┤
    │  权限管理服务   │ 消息通知服务 │ 评价管理服务 │  日志管理服务   │
    └─────────────────┴─────────────┴─────────────┴─────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                   数据访问层 (Data Access Layer)           │
    ├─────────────────────────────────────────────────────────────┤
    │                         数据访问对象 (DAO)                  │
    │  UserDAO  │ BookingDAO │ PaymentDAO │ MatchDAO │ CampusDAO  │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                       数据层 (Data Layer)                  │
    ├─────────────────────────────────────────────────────────────┤
    │    MySQL数据库      │      Redis缓存       │   文件存储     │
    │  - 业务数据表       │  - 会话信息          │  - 用户照片    │
    │  - 日志记录表       │  - 缓存数据          │  - 系统文档    │
    └─────────────────────────────────────────────────────────────┘
```

## 3. 详细模块结构图

### 3.1 用户管理模块

```
                          用户管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     用户注册子模块       用户认证子模块       用户信息管理子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │学员注册 │         │用户登录 │         │信息查询 │
   │教练注册 │         │会话管理 │         │信息修改 │
   │管理员注册│         │权限验证 │         │密码修改 │
   │注册审核 │         │登录日志 │         │状态管理 │
   └─────────┘         └─────────┘         └─────────┘
```

### 3.2 教练选择管理模块

```
                        教练选择管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     教练查询子模块       双选关系子模块       关系维护子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │按条件查询│         │选择申请 │         │关系查询 │
   │教练浏览 │         │申请审核 │         │关系解除 │
   │教练详情 │         │关系建立 │         │更换教练 │
   │收藏教练 │         │消息通知 │         │历史记录 │
   └─────────┘         └─────────┘         └─────────┘
```

### 3.3 课程预约管理模块

```
                        课程预约管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     课表管理子模块       预约处理子模块       预约维护子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │课表查询 │         │预约申请 │         │预约查询 │
   │时间段管理│         │预约确认 │         │预约取消 │
   │球台分配 │         │冲突检测 │         │取消限制 │
   │课表生成 │         │通知发送 │         │历史记录 │
   └─────────┘         └─────────┘         └─────────┘
```

### 3.4 收费管理模块

```
                          收费管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     账户管理子模块       支付处理子模块       财务统计子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │账户查询 │         │在线支付 │         │收入统计 │
   │余额管理 │         │线下支付 │         │支出统计 │
   │充值功能 │         │退费处理 │         │报表生成 │
   │账户冻结 │         │支付验证 │         │数据导出 │
   └─────────┘         └─────────┘         └─────────┘
```

### 3.5 比赛管理模块

```
                          比赛管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     比赛组织子模块       报名管理子模块       赛程安排子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │比赛创建 │         │学员报名 │         │分组算法 │
   │规则设置 │         │费用收取 │         │赛程生成 │
   │时间安排 │         │报名审核 │         │球台分配 │
   │结果录入 │         │名单管理 │         │结果统计 │
   └─────────┘         └─────────┘         └─────────┘
```

### 3.6 系统管理模块

```
                          系统管理模块
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
     校区管理子模块       权限管理子模块       系统监控子模块
        │                    │                    │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │校区增删 │         │角色定义 │         │系统日志 │
   │基本信息 │         │权限分配 │         │性能监控 │
   │管理员指定│         │访问控制 │         │错误跟踪 │
   │设备管理 │         │操作审计 │         │数据备份 │
   └─────────┘         └─────────┘         └─────────┘
```

## 4. 核心服务模块设计

### 4.1 用户管理服务 (UserService)

```
UserService
├── UserRegistrationService      # 用户注册服务
│   ├── validateRegistrationInfo()    # 验证注册信息
│   ├── createUser()                  # 创建用户
│   ├── sendVerificationEmail()       # 发送验证邮件
│   └── approveCoachRegistration()    # 审核教练注册
│
├── UserAuthenticationService    # 用户认证服务
│   ├── authenticate()               # 用户认证
│   ├── generateToken()              # 生成访问令牌
│   ├── validateToken()              # 验证令牌
│   └── logout()                     # 用户登出
│
└── UserProfileService           # 用户资料服务
    ├── getUserProfile()             # 获取用户资料
    ├── updateProfile()              # 更新用户资料
    ├── changePassword()             # 修改密码
    └── uploadPhoto()                # 上传照片
```

### 4.2 预约管理服务 (BookingService)

```
BookingService
├── ScheduleService              # 课表服务
│   ├── getCoachSchedule()           # 获取教练课表
│   ├── getAvailableSlots()          # 获取可用时间段
│   ├── checkTableAvailability()     # 检查球台可用性
│   └── generateWeeklySchedule()     # 生成周课表
│
├── BookingProcessService        # 预约处理服务
│   ├── createBooking()              # 创建预约
│   ├── confirmBooking()             # 确认预约
│   ├── cancelBooking()              # 取消预约
│   └── checkCancellationLimit()     # 检查取消限制
│
└── BookingNotificationService   # 预约通知服务
    ├── sendBookingRequest()         # 发送预约请求
    ├── sendConfirmation()           # 发送确认通知
    ├── sendReminder()               # 发送上课提醒
    └── sendCancellation()           # 发送取消通知
```

### 4.3 支付管理服务 (PaymentService)

```
PaymentService
├── AccountService               # 账户服务
│   ├── getBalance()                 # 获取账户余额
│   ├── deposit()                    # 账户充值
│   ├── withdraw()                   # 账户扣费
│   └── freezeAccount()              # 冻结账户
│
├── PaymentProcessService        # 支付处理服务
│   ├── processOnlinePayment()       # 处理在线支付
│   ├── processOfflinePayment()      # 处理线下支付
│   ├── refund()                     # 退款处理
│   └── validatePayment()            # 验证支付
│
└── TransactionService           # 交易服务
    ├── recordTransaction()          # 记录交易
    ├── getTransactionHistory()      # 获取交易历史
    ├── generateReport()             # 生成财务报表
    └── exportData()                 # 导出数据
```

### 4.4 比赛管理服务 (MatchService)

```
MatchService
├── MatchOrganizationService     # 比赛组织服务
│   ├── createMatch()                # 创建比赛
│   ├── setMatchRules()              # 设置比赛规则
│   ├── scheduleMatch()              # 安排比赛时间
│   └── recordResult()               # 记录比赛结果
│
├── RegistrationService          # 报名服务
│   ├── registerForMatch()           # 学员报名
│   ├── processRegistrationFee()     # 处理报名费
│   ├── validateRegistration()       # 验证报名信息
│   └── getRegistrationList()        # 获取报名名单
│
└── TournamentService            # 赛程服务
    ├── groupParticipants()          # 参赛者分组
    ├── generateSchedule()           # 生成赛程
    ├── assignTables()               # 分配球台
    └── calculateRankings()          # 计算排名
```

## 5. 数据访问层设计

### 5.1 DAO接口定义

```
BaseDAO<T>
├── save(T entity)              # 保存实体
├── update(T entity)            # 更新实体
├── delete(Long id)             # 删除实体
├── findById(Long id)           # 根据ID查找
├── findAll()                   # 查找所有
└── findByCondition(Condition)  # 条件查询

UserDAO extends BaseDAO<User>
├── findByUsername(String username)
├── findByPhone(String phone)
├── findByEmail(String email)
├── findByCampus(Long campusId)
└── findByUserType(UserType type)

BookingDAO extends BaseDAO<Booking>
├── findByStudent(Long studentId)
├── findByCoach(Long coachId)
├── findByDate(Date date)
├── findByDateRange(Date start, Date end)
└── findConflictingBookings()

PaymentDAO extends BaseDAO<Transaction>
├── findByUser(Long userId)
├── findByType(TransactionType type)
├── findByDateRange(Date start, Date end)
└── calculateTotalByUser(Long userId)
```

## 6. 技术架构组件

### 6.1 前端技术栈

```
前端架构
├── Vue.js 3.x                  # 前端框架
├── Vue Router                  # 路由管理
├── Vuex/Pinia                  # 状态管理
├── Element Plus                # UI组件库
├── Axios                       # HTTP客户端
├── ECharts                     # 图表组件
└── PWA                         # 渐进式Web应用
```

### 6.2 后端技术栈

```
后端架构
├── Spring Boot 2.x             # 应用框架
├── Spring Security             # 安全框架
├── Spring Data JPA             # 数据访问
├── MySQL 8.0                   # 主数据库
├── Redis 6.x                   # 缓存数据库
├── RabbitMQ                    # 消息队列
├── Swagger                     # API文档
└── Docker                      # 容器化部署
```

### 6.3 第三方集成

```
第三方服务
├── 支付平台
│   ├── 微信支付API              # 微信支付集成
│   └── 支付宝API                # 支付宝支付集成
│
├── 消息服务
│   ├── 短信服务API              # 短信通知
│   ├── 邮件服务API              # 邮件通知
│   └── 推送服务API              # 移动端推送
│
└── 监控服务
    ├── 日志收集                 # ELK Stack
    ├── 性能监控                 # APM工具
    └── 错误追踪                 # Sentry
```

## 7. 部署架构设计

### 7.1 生产环境架构

```
                        生产环境部署架构

    ┌─────────────────────────────────────────────────────────────┐
    │                        负载均衡层                           │
    │                    Nginx Load Balancer                     │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                        应用服务层                           │
    │   App Server 1    │   App Server 2    │   App Server 3     │
    │   (Docker容器)    │   (Docker容器)    │   (Docker容器)     │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                        数据服务层                           │
    │   MySQL主库       │   MySQL从库       │   Redis集群        │
    │   (主写节点)      │   (只读节点)      │   (缓存集群)       │
    └─────────────────────────────────────────────────────────────┘
```

### 7.2 微服务架构（可选）

```
                          微服务架构设计

    ┌─────────────────────────────────────────────────────────────┐
    │                        API网关                             │
    │                    Spring Cloud Gateway                    │
    └─────────────────────────────────────────────────────────────┘
                                   │
        ┌──────────────────────────┼──────────────────────────┐
        │                          │                          │
    ┌───▼───┐              ┌──────▼──────┐              ┌───▼───┐
    │用户服务│              │ 预约服务    │              │支付服务│
    │8001端口│              │ 8002端口    │              │8003端口│
    └───────┘              └─────────────┘              └───────┘
        │                          │                          │
    ┌───▼───┐              ┌──────▼──────┐              ┌───▼───┐
    │比赛服务│              │ 消息服务    │              │日志服务│
    │8004端口│              │ 8005端口    │              │8006端口│
    └───────┘              └─────────────┘              └───────┘
                                   │
                          ┌────────▼────────┐
                          │   服务注册中心   │
                          │     Eureka      │
                          └─────────────────┘
```

## 8. 模块间依赖关系

### 8.1 核心依赖图

```
                          模块依赖关系图

    ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
    │   用户管理   │◄────────┤   权限管理   │────────►│   日志管理   │
    └─────────────┘         └─────────────┘         └─────────────┘
            │                       │                       ▲
            ▼                       ▼                       │
    ┌─────────────┐         ┌─────────────┐                 │
    │   教练选择   │         │   消息通知   │─────────────────┘
    └─────────────┘         └─────────────┘
            │                       ▲
            ▼                       │
    ┌─────────────┐         ┌─────────────┐
    │   课程预约   │────────►│   收费管理   │
    └─────────────┘         └─────────────┘
            │                       │
            ▼                       ▼
    ┌─────────────┐         ┌─────────────┐
    │   评价管理   │         │   比赛管理   │
    └─────────────┘         └─────────────┘
```

### 8.2 依赖说明

1. **用户管理模块** - 为所有其他模块提供用户基础信息
2. **权限管理模块** - 控制用户对各功能模块的访问权限
3. **教练选择模块** - 依赖用户管理，为预约模块提供师生关系
4. **课程预约模块** - 依赖教练选择和收费管理
5. **收费管理模块** - 为预约和比赛提供支付功能
6. **消息通知模块** - 为各业务模块提供通知服务
7. **日志管理模块** - 记录所有模块的操作日志
8. **比赛管理模块** - 依赖用户管理和收费管理

## 9. 安全架构设计

### 9.1 安全层级

```
                            安全架构层级

    ┌─────────────────────────────────────────────────────────────┐
    │                        网络安全层                           │
    │   HTTPS加密    │   防火墙配置   │   DDoS防护               │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                        应用安全层                           │
    │   JWT认证      │   权限控制     │   输入验证               │
    └─────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                        数据安全层                           │
    │   数据加密     │   访问控制     │   备份恢复               │
    └─────────────────────────────────────────────────────────────┘
```

### 9.2 安全组件

- **认证组件**: JWT令牌管理、会话管理
- **授权组件**: RBAC权限控制、资源访问控制
- **加密组件**: 密码加密、敏感数据加密
- **审计组件**: 操作日志、安全事件记录