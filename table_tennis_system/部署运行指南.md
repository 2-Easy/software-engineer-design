# 乒乓球培训管理系统 - 部署运行指南

## 🚀 快速开始

本指南将帮助您在 macOS 系统上快速部署和运行乒乓球培训管理系统。

## 📋 环境要求

### 必需软件
```bash
Python 3.8+
MySQL 8.0+
pip (Python包管理器)
```

### 推荐软件
```bash
VS Code (代码编辑器)
Postman (API测试)
Sequel Pro 或 phpMyAdmin (数据库管理)
```

## 🔧 安装步骤

### 1. 安装 Python 3.8+

#### 方法一：使用 Homebrew (推荐)
```bash
# 安装 Homebrew (如果未安装)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Python
brew install python@3.9

# 验证安装
python3 --version
pip3 --version
```

#### 方法二：从官网下载
访问 [Python官网](https://www.python.org/downloads/) 下载并安装最新版本。

### 2. 安装 MySQL 8.0

#### 方法一：使用 Homebrew (推荐)
```bash
# 安装 MySQL
brew install mysql

# 启动 MySQL 服务
brew services start mysql

# 初始化 MySQL (设置root密码)
mysql_secure_installation
```

#### 方法二：使用 MySQL 官方安装包
1. 访问 [MySQL官网](https://dev.mysql.com/downloads/mysql/)
2. 下载 macOS 版本的 MySQL 安装包
3. 按照安装向导完成安装

### 3. 验证 MySQL 安装
```bash
# 测试连接 (输入您设置的root密码)
mysql -u root -p

# 在MySQL控制台中执行
mysql> SELECT VERSION();
mysql> EXIT;
```

## 📁 项目部署

### 1. 获取项目代码
```bash
# 假设项目已经在您的课程设计目录中
cd "/Users/xtanbhjjy/Jlu/软件工程课程设计(2025)/table_tennis_system"
```

### 2. 创建Python虚拟环境 (推荐)
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 验证虚拟环境
which python
which pip
```

### 3. 安装Python依赖
```bash
# 安装项目依赖
pip install -r requirements.txt

# 如果遇到权限问题，使用 --user 选项
pip install --user -r requirements.txt
```

### 4. 配置环境变量 (可选)
```bash
# 创建环境变量文件
touch backend/.env

# 编辑环境变量文件
cat > backend/.env << 'EOF'
# 数据库配置
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=你的MySQL密码
MYSQL_DATABASE=table_tennis_db

# 应用配置
SECRET_KEY=your-secret-key-change-in-production
JWT_SECRET_KEY=your-jwt-secret-key

# 开发环境
NODE_ENV=development
EOF
```

### 5. 初始化数据库
```bash
# 进入数据库目录
cd database

# 给初始化脚本添加执行权限
chmod +x init.sh

# 运行初始化脚本
./init.sh

# 如果脚本执行有问题，可以手动执行SQL
mysql -u root -p < schema.sql
mysql -u root -p < sample_data.sql
```

### 6. 启动后端服务
```bash
# 进入后端目录
cd ../backend

# 启动Flask应用
python app.py
```

如果一切正常，您应该看到类似以下的输出：
```
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://[::1]:5000
 * Debug mode: on
```

### 7. 访问前端界面
打开浏览器访问：
- 主页: http://localhost:5000
- 学员界面: http://localhost:5000/frontend/dashboard/student.html

## 🧪 测试系统

### 1. 健康检查
```bash
# 测试后端API
curl http://localhost:5000/api/health
```

### 2. 使用演示账号登录
| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 超级管理员 | admin | 123456 | 完整系统权限 |
| 校区管理员 | campus_admin1 | 123456 | 校区管理权限 |
| 教练 | coach1 | 123456 | 教练功能 |
| 学员 | student1 | 123456 | 学员功能 |

### 3. 功能测试清单

#### 基础功能测试
- [ ] 用户注册 (学员/教练)
- [ ] 用户登录/登出
- [ ] 个人信息修改

#### 教练选择测试
- [ ] 学员查看教练列表
- [ ] 学员申请选择教练
- [ ] 教练审核学员申请

#### 课程预约测试
- [ ] 查看教练课表
- [ ] 创建课程预约
- [ ] 教练确认预约
- [ ] 取消预约

#### 收费管理测试
- [ ] 查看账户余额
- [ ] 账户充值
- [ ] 自动扣费
- [ ] 交易记录查询

#### 比赛管理测试
- [ ] 查看比赛列表
- [ ] 学员报名比赛
- [ ] 管理员创建比赛

## 🛠️ 常见问题解决

### 1. Python依赖安装失败
```bash
# 升级pip
pip install --upgrade pip

# 清除缓存
pip cache purge

# 重新安装依赖
pip install -r requirements.txt
```

### 2. MySQL连接失败
```bash
# 检查MySQL服务状态
brew services list | grep mysql

# 重启MySQL服务
brew services restart mysql

# 检查端口占用
lsof -i :3306
```

### 3. 端口被占用 (5000端口)
```bash
# 查看端口占用
lsof -i :5000

# 杀死占用进程
kill -9 <PID>

# 或者修改Flask端口
python app.py --port 5001
```

### 4. 数据库初始化失败
```bash
# 手动创建数据库
mysql -u root -p -e "CREATE DATABASE table_tennis_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 手动执行SQL文件
mysql -u root -p table_tennis_db < database/schema.sql
mysql -u root -p table_tennis_db < database/sample_data.sql
```

### 5. 前端页面无法访问
确保：
- Flask应用正在运行
- 防火墙没有阻止5000端口
- 浏览器没有缓存问题 (试试无痕模式)

## 📝 开发提示

### 1. 修改代码后重启服务
Flask开启了调试模式，代码修改后会自动重启，但如果遇到问题可以手动重启：
```bash
# Ctrl+C 停止服务
# 然后重新启动
python app.py
```

### 2. 查看日志
```bash
# Flask会在控制台输出日志
# 如果需要更详细的日志，可以检查：
tail -f /tmp/flask.log  # 如果配置了日志文件
```

### 3. 数据库操作
```bash
# 连接到MySQL
mysql -u root -p table_tennis_db

# 查看所有表
SHOW TABLES;

# 查看用户数据
SELECT * FROM users LIMIT 5;

# 查看预约数据
SELECT * FROM bookings ORDER BY created_at DESC LIMIT 5;
```

### 4. API测试
使用 Postman 或 curl 测试API：
```bash
# 测试登录API
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"student1","password":"123456"}'

# 测试获取教练列表
curl -X GET http://localhost:5000/api/user/coaches \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 🔧 高级配置

### 1. 配置HTTPS (生产环境)
```bash
# 生成自签名证书 (仅用于测试)
openssl req -x509 -newkey rsa:4096 -nodes -out cert.pem -keyout key.pem -days 365

# 修改app.py，添加SSL配置
app.run(host='0.0.0.0', port=5000, debug=True, ssl_context=('cert.pem', 'key.pem'))
```

### 2. 配置反向代理 (Nginx)
```nginx
server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 3. 数据库性能优化
```sql
-- 添加索引优化查询性能
CREATE INDEX idx_booking_date_coach ON bookings(booking_date, coach_id);
CREATE INDEX idx_user_campus_type ON users(campus_id, user_type);
```

## 📊 系统监控

### 1. 查看系统状态
```bash
# 检查磁盘空间
df -h

# 检查内存使用
top -l 1 | grep PhysMem

# 检查数据库大小
mysql -u root -p -e "SELECT table_schema AS 'Database', ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)' FROM information_schema.tables WHERE table_schema='table_tennis_db';"
```

### 2. 备份数据库
```bash
# 创建备份目录
mkdir -p backups

# 备份数据库
mysqldump -u root -p table_tennis_db > backups/backup_$(date +%Y%m%d_%H%M%S).sql

# 恢复数据库
mysql -u root -p table_tennis_db < backups/backup_file.sql
```

## 🎯 下一步工作

完成基本部署后，您可以：

1. **完善功能**：添加更多前端页面和交互功能
2. **优化性能**：添加缓存、优化数据库查询
3. **增强安全**：添加更多验证和防护措施
4. **扩展功能**：集成真实的支付接口、短信通知等
5. **部署生产**：使用Docker容器化部署

## 📞 技术支持

如果遇到问题：
1. 检查错误日志
2. 确认环境配置
3. 查看API响应
4. 重启服务试试

---

**祝您使用愉快！**

系统已具备完整的核心功能，可以满足软件工程课程设计的演示需求。