<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员仪表板 - 乒乓球培训管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="../../assets/css/common.css" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid px-3">
            <a class="navbar-brand" href="/">
                <i class="fas fa-table-tennis me-2"></i>
                乒乓球培训管理系统
            </a>

            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                        <div class="user-avatar me-2" data-user="avatar">A</div>
                        <span data-user="name">管理员</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>个人资料</a></li>
                        <li><a class="dropdown-item" href="settings.html"><i class="fas fa-cog me-2"></i>系统设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" data-action="logout"><i class="fas fa-sign-out-alt me-2"></i>退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="p-3">
                    <div class="d-flex align-items-center mb-4">
                        <div class="user-avatar me-3" data-user="avatar">A</div>
                        <div>
                            <div class="fw-semibold" data-user="name">管理员</div>
                            <small class="text-muted" data-user="type">管理员</small>
                        </div>
                    </div>
                </div>

                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        仪表板
                    </a>
                    <a class="nav-link" href="#" data-page="users">
                        <i class="fas fa-users"></i>
                        用户管理
                    </a>
                    <a class="nav-link" href="#" data-page="bookings">
                        <i class="fas fa-calendar-check"></i>
                        预约管理
                    </a>
                    <a class="nav-link" href="#" data-page="matches">
                        <i class="fas fa-trophy"></i>
                        比赛管理
                    </a>
                    <a class="nav-link" href="#" data-page="finances">
                        <i class="fas fa-chart-line"></i>
                        财务统计
                    </a>
                    <a class="nav-link" href="#" data-page="campus">
                        <i class="fas fa-building"></i>
                        校区管理
                    </a>
                    <a class="nav-link" href="#" data-page="system">
                        <i class="fas fa-cog"></i>
                        系统管理
                    </a>
                </nav>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- 仪表板页面 -->
                <div id="dashboardPage" class="page-content fade-in">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">管理员仪表板</h2>
                        <div class="text-muted">
                            <i class="fas fa-calendar me-2"></i>
                            <span id="currentDateTime"></span>
                        </div>
                    </div>

                    <!-- 统计卡片 -->
                    <div class="row g-4 mb-4">
                        <div class="col-lg-3 col-md-6">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="stat-label">总用户数</div>
                                            <div class="stat-value" id="totalUsers">0</div>
                                        </div>
                                        <div class="stat-icon primary">
                                            <i class="fas fa-users"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="stat-label">活跃预约</div>
                                            <div class="stat-value" id="activeBookings">0</div>
                                        </div>
                                        <div class="stat-icon success">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="stat-label">本月收入</div>
                                            <div class="stat-value" id="monthlyRevenue">¥0.00</div>
                                        </div>
                                        <div class="stat-icon warning">
                                            <i class="fas fa-dollar-sign"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="stat-label">进行中比赛</div>
                                            <div class="stat-value" id="ongoingMatches">0</div>
                                        </div>
                                        <div class="stat-icon info">
                                            <i class="fas fa-trophy"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 图表和最新活动 -->
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">收入趋势图</h6>
                                </div>
                                <div class="card-body">
                                    <div id="revenueChart">
                                        <div class="text-center text-muted py-5">
                                            <i class="fas fa-chart-line fa-3x mb-3 d-block"></i>
                                            <h5>收入趋势图</h5>
                                            <p>功能正在开发中...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">最新活动</h6>
                                </div>
                                <div class="card-body">
                                    <div id="recentActivities">
                                        <!-- 活动列表 -->
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-4">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">系统状态</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>数据库</span>
                                        <span class="badge bg-success">正常</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>支付系统</span>
                                        <span class="badge bg-success">正常</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>短信服务</span>
                                        <span class="badge bg-warning">维护中</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>存储空间</span>
                                        <span class="badge bg-info">85%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户管理页面 -->
                <div id="usersPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">用户管理</h2>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" onclick="showAddUserModal()">
                                <i class="fas fa-plus me-2"></i>添加用户
                            </button>
                            <button class="btn btn-outline-primary" onclick="exportUsers()">
                                <i class="fas fa-download me-2"></i>导出
                            </button>
                        </div>
                    </div>

                    <!-- 用户筛选 -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <select class="form-select" id="filterUserType">
                                        <option value="">所有用户类型</option>
                                        <option value="student">学员</option>
                                        <option value="coach">教练</option>
                                        <option value="campus_admin">校区管理员</option>
                                        <option value="super_admin">超级管理员</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="filterStatus">
                                        <option value="">所有状态</option>
                                        <option value="active">活跃</option>
                                        <option value="inactive">非活跃</option>
                                        <option value="pending">待审核</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="searchUser" placeholder="搜索用户名或姓名">
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-outline-primary w-100" onclick="filterUsers()">
                                        <i class="fas fa-search me-2"></i>搜索
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 用户列表 -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead>
                                        <tr>
                                            <th>用户</th>
                                            <th>类型</th>
                                            <th>联系方式</th>
                                            <th>注册时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTable">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">
                                                <i class="fas fa-users fa-2x mb-2 d-block"></i>
                                                正在加载用户数据...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 用户分页 -->
                            <nav aria-label="用户分页" id="usersPagination" style="display: none;">
                                <ul class="pagination justify-content-center">
                                    <!-- 分页按钮将在此动态生成 -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- 预约管理页面 -->
                <div id="bookingsPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">预约管理</h2>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary" onclick="exportBookings()">
                                <i class="fas fa-download me-2"></i>导出预约
                            </button>
                            <button class="btn btn-outline-secondary" onclick="refreshBookings()">
                                <i class="fas fa-sync me-2"></i>刷新
                            </button>
                        </div>
                    </div>

                    <!-- 预约筛选 -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <select class="form-select" id="filterBookingStatus">
                                        <option value="">所有状态</option>
                                        <option value="pending">待确认</option>
                                        <option value="confirmed">已确认</option>
                                        <option value="completed">已完成</option>
                                        <option value="cancelled">已取消</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="filterBookingCampus">
                                        <option value="">所有校区</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <input type="date" class="form-control" id="filterBookingDate">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary w-100" onclick="filterAllBookings()">
                                        <i class="fas fa-search me-2"></i>筛选
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 预约统计 -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon warning mx-auto mb-3">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <h3 class="text-warning" id="pendingBookingsCount">0</h3>
                                    <p class="text-muted mb-0">待确认预约</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon success mx-auto mb-3">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <h3 class="text-success" id="confirmedBookingsCount">0</h3>
                                    <p class="text-muted mb-0">已确认预约</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon info mx-auto mb-3">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <h3 class="text-info" id="completedBookingsCount">0</h3>
                                    <p class="text-muted mb-0">已完成预约</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon primary mx-auto mb-3">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <h3 class="text-primary" id="totalBookingRevenue">¥0.00</h3>
                                    <p class="text-muted mb-0">总收入</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 预约列表 -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>学员</th>
                                            <th>教练</th>
                                            <th>校区</th>
                                            <th>日期时间</th>
                                            <th>球台</th>
                                            <th>费用</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allBookingsTable">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-4">
                                                <i class="fas fa-calendar-check fa-2x mb-2 d-block"></i>
                                                正在加载预约数据...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 分页 -->
                            <nav aria-label="预约分页" id="bookingsPagination" style="display: none;">
                                <ul class="pagination justify-content-center">
                                    <!-- 分页按钮将在此动态生成 -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- 比赛管理页面 -->
                <div id="matchesPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">比赛管理</h2>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" onclick="showAddMatchModal()">
                                <i class="fas fa-plus me-2"></i>创建比赛
                            </button>
                            <button class="btn btn-outline-primary" onclick="exportMatches()">
                                <i class="fas fa-download me-2"></i>导出比赛
                            </button>
                        </div>
                    </div>

                    <!-- 比赛筛选 -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <select class="form-select" id="filterMatchStatus">
                                        <option value="">所有状态</option>
                                        <option value="upcoming">即将开始</option>
                                        <option value="registration">报名中</option>
                                        <option value="ongoing">进行中</option>
                                        <option value="completed">已结束</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="filterMatchCampus">
                                        <option value="">所有校区</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <input type="date" class="form-control" id="filterMatchDate">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary w-100" onclick="filterAllMatches()">
                                        <i class="fas fa-search me-2"></i>筛选
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 比赛统计 -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon info mx-auto mb-3">
                                        <i class="fas fa-calendar-plus"></i>
                                    </div>
                                    <h3 class="text-info" id="upcomingMatchesCount">0</h3>
                                    <p class="text-muted mb-0">即将开始</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon success mx-auto mb-3">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <h3 class="text-success" id="registrationMatchesCount">0</h3>
                                    <p class="text-muted mb-0">报名中</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon warning mx-auto mb-3">
                                        <i class="fas fa-play"></i>
                                    </div>
                                    <h3 class="text-warning" id="ongoingMatchesCount">0</h3>
                                    <p class="text-muted mb-0">进行中</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon primary mx-auto mb-3">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <h3 class="text-primary" id="totalParticipants">0</h3>
                                    <p class="text-muted mb-0">总参赛人数</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 比赛列表 -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>比赛名称</th>
                                            <th>校区</th>
                                            <th>比赛日期</th>
                                            <th>报名截止</th>
                                            <th>报名费</th>
                                            <th>参赛人数</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allMatchesTable">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-4">
                                                <i class="fas fa-trophy fa-2x mb-2 d-block"></i>
                                                正在加载比赛数据...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 分页 -->
                            <nav aria-label="比赛分页" id="matchesPagination" style="display: none;">
                                <ul class="pagination justify-content-center">
                                    <!-- 分页按钮将在此动态生成 -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- 财务统计页面 -->
                <div id="financesPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">财务统计</h2>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary" onclick="exportFinanceReport()">
                                <i class="fas fa-file-excel me-2"></i>导出报表
                            </button>
                        </div>
                    </div>

                    <!-- 财务概览 -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon success mx-auto mb-3">
                                        <i class="fas fa-arrow-up"></i>
                                    </div>
                                    <h3 class="text-success" id="totalIncome">¥0.00</h3>
                                    <p class="text-muted mb-0">总收入</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon danger mx-auto mb-3">
                                        <i class="fas fa-arrow-down"></i>
                                    </div>
                                    <h3 class="text-danger" id="totalExpenses">¥0.00</h3>
                                    <p class="text-muted mb-0">总支出</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon primary mx-auto mb-3">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h3 class="text-primary" id="netProfit">¥0.00</h3>
                                    <p class="text-muted mb-0">净利润</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <div class="stat-icon info mx-auto mb-3">
                                        <i class="fas fa-percent"></i>
                                    </div>
                                    <h3 class="text-info" id="profitMargin">0%</h3>
                                    <p class="text-muted mb-0">利润率</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 财务图表 -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">收支分析</h6>
                        </div>
                        <div class="card-body">
                            <div id="financeChart">
                                <div class="text-center text-muted py-5">
                                    <i class="fas fa-chart-bar fa-3x mb-3 d-block"></i>
                                    <h5>财务图表</h5>
                                    <p>功能正在开发中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 校区管理页面 -->
                <div id="campusPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">校区管理</h2>
                        <button class="btn btn-primary" onclick="showAddCampusModal()">
                            <i class="fas fa-plus me-2"></i>添加校区
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="text-center text-muted py-5">
                                <i class="fas fa-building fa-3x mb-3 d-block"></i>
                                <h5>校区管理</h5>
                                <p>功能正在开发中...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统管理页面 -->
                <div id="systemPage" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h4 mb-0">系统管理</h2>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">系统配置</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" onclick="showSystemConfig()">
                                            <i class="fas fa-cog me-2"></i>系统设置
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewSystemLogs()">
                                            <i class="fas fa-file-alt me-2"></i>查看日志
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="backupDatabase()">
                                            <i class="fas fa-database me-2"></i>数据库备份
                                        </button>
                                        <button class="btn btn-outline-success" onclick="clearCache()">
                                            <i class="fas fa-trash me-2"></i>清除缓存
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">系统监控</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>CPU使用率</span>
                                            <span>15%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" style="width: 15%"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>内存使用率</span>
                                            <span>62%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" style="width: 62%"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>磁盘使用率</span>
                                            <span>85%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-danger" style="width: 85%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建比赛模态框 -->
    <div class="modal fade" id="addMatchModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">创建比赛</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addMatchForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">比赛名称 *</label>
                                <input type="text" class="form-control" id="matchName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">校区 *</label>
                                <select class="form-select" id="matchCampusId" required>
                                    <option value="">请选择校区</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">比赛日期 *</label>
                                <input type="date" class="form-control" id="matchDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">比赛时间 *</label>
                                <input type="time" class="form-control" id="matchTime" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">报名截止日期 *</label>
                                <input type="date" class="form-control" id="registrationEnd" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">报名费 (元) *</label>
                                <input type="number" class="form-control" id="registrationFee" min="0" step="0.01" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">最大参赛人数</label>
                                <input type="number" class="form-control" id="maxParticipants" min="1" value="32">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">比赛类型</label>
                                <select class="form-select" id="matchType">
                                    <option value="singles">单打</option>
                                    <option value="doubles">双打</option>
                                    <option value="mixed">混合</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">比赛描述</label>
                                <textarea class="form-control" id="matchDescription" rows="3"></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label">奖金设置</label>
                                <textarea class="form-control" id="prizeInfo" rows="2" placeholder="例如：冠军500元，亚军300元，季军200元"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddMatch()">创建比赛</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../../assets/js/common.js"></script>
    <script>
        // 页面特定的变量
        let currentPage = 'dashboard';
        let currentUserFilters = {};

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            setupPageNavigation();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            loadDashboardData();
        });

        // 设置页面导航
        function setupPageNavigation() {
            document.querySelectorAll('[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });
        }

        // 显示指定页面
        function showPage(pageName) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });

            const targetPage = document.getElementById(pageName + 'Page');
            if (targetPage) {
                targetPage.style.display = 'block';
                targetPage.classList.add('fade-in');
            }

            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active');

            currentPage = pageName;
            loadPageData(pageName);
        }

        // 加载页面数据
        function loadPageData(pageName) {
            switch (pageName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'bookings':
                    loadBookings();
                    // 加载校区列表到筛选器
                    loadCampusForFilter('filterBookingCampus');
                    break;
                case 'matches':
                    loadMatches();
                    // 加载校区列表到筛选器
                    loadCampusForFilter('filterMatchCampus');
                    break;
                case 'finances':
                    loadFinances();
                    break;
                case 'campus':
                    loadCampus();
                    break;
                case 'system':
                    loadSystem();
                    break;
            }
        }

        // 为筛选器加载校区列表
        async function loadCampusForFilter(selectId) {
            try {
                const result = await API.get('/user/campus');
                if (result.success) {
                    const select = document.getElementById(selectId);
                    if (select) {
                        // 清除现有选项（除了第一个"所有校区"选项）
                        const firstOption = select.querySelector('option[value=""]');
                        select.innerHTML = '';
                        if (firstOption) {
                            select.appendChild(firstOption);
                        } else {
                            const allOption = document.createElement('option');
                            allOption.value = '';
                            allOption.textContent = '所有校区';
                            select.appendChild(allOption);
                        }

                        // API返回的数据可能在不同的层级
                        const campuses = result.data.data || result.data || [];
                        campuses.forEach(campus => {
                            const option = document.createElement('option');
                            option.value = campus.id;
                            option.textContent = campus.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('加载校区列表失败:', error);
            }
        }

        // 更新当前时间
        function updateCurrentTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('zh-CN', options);
        }

        // 加载仪表板数据
        async function loadDashboardData() {
            try {
                // 模拟数据加载
                document.getElementById('totalUsers').textContent = '156';
                document.getElementById('activeBookings').textContent = '23';
                document.getElementById('monthlyRevenue').textContent = '¥18,540.00';
                document.getElementById('ongoingMatches').textContent = '2';

                // 加载最新活动
                loadRecentActivities();
            } catch (error) {
                console.error('加载仪表板数据失败:', error);
            }
        }

        // 加载最新活动
        function loadRecentActivities() {
            const container = document.getElementById('recentActivities');
            const activities = [
                { time: '刚刚', action: '用户 张三 完成了课程预约', type: 'booking' },
                { time: '5分钟前', action: '教练 李四 确认了预约请求', type: 'confirm' },
                { time: '15分钟前', action: '新用户 王五 注册成功', type: 'register' },
                { time: '30分钟前', action: '用户 赵六 充值了 ¥200', type: 'payment' },
                { time: '1小时前', action: '比赛 "月度挑战赛" 报名开始', type: 'match' }
            ];

            container.innerHTML = activities.map(activity => `
                <div class="d-flex align-items-start mb-3">
                    <div class="flex-shrink-0 me-3">
                        <i class="fas fa-${getActivityIcon(activity.type)} text-${getActivityColor(activity.type)}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="small fw-medium">${activity.action}</div>
                        <div class="text-muted small">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // 获取活动图标
        function getActivityIcon(type) {
            const icons = {
                'booking': 'calendar-plus',
                'confirm': 'check',
                'register': 'user-plus',
                'payment': 'credit-card',
                'match': 'trophy'
            };
            return icons[type] || 'info-circle';
        }

        // 获取活动颜色
        function getActivityColor(type) {
            const colors = {
                'booking': 'primary',
                'confirm': 'success',
                'register': 'info',
                'payment': 'warning',
                'match': 'danger'
            };
            return colors[type] || 'secondary';
        }

        // 筛选用户
        function filterUsers() {
            currentUserFilters = {
                user_type: document.getElementById('filterUserType').value,
                status: document.getElementById('filterStatus').value,
                search: document.getElementById('searchUser').value
            };
            loadUsers(1, currentUserFilters);
        }

        // 加载用户列表
        async function loadUsers(page = 1, filters = currentUserFilters) {
            try {
                let url = `/user/all?page=${page}`;
                if (filters.user_type) {
                    url += `&user_type=${filters.user_type}`;
                }
                if (filters.status) {
                    url += `&status=${filters.status}`;
                }
                if (filters.search) {
                    url += `&search=${filters.search}`;
                }
                const result = await API.get(url);

                if (result.success) {
                    const data = result.data.data;
                    const users = data.items || [];
                    displayUsers(users);
                    updateUsersPagination(data, filters);
                } else {
                    showToast('加载用户列表失败', 'error');
                }

                // 加载待审批教练到单独区域
                loadPendingCoaches();
            } catch (error) {
                console.error('加载用户列表失败:', error);
                showToast('加载用户列表失败', 'error');
            }
        }

        // 加载待审批教练
        async function loadPendingCoaches() {
            try {
                const result = await API.get('/user/coach-applications');
                if (result.success) {
                    const pendingCoaches = result.data.data.items || [];
                    displayPendingCoaches(pendingCoaches);
                }
            } catch (error) {
                console.error('加载待审批教练失败:', error);
            }
        }

        // 显示待审批教练
        function displayPendingCoaches(coaches) {
            if (coaches.length === 0) {
                return;
            }

            // 在用户管理页面顶部添加待审批教练区域
            const usersPage = document.getElementById('usersPage');
            const existingPendingSection = usersPage.querySelector('.pending-coaches-section');

            if (existingPendingSection) {
                existingPendingSection.remove();
            }

            const pendingSection = document.createElement('div');
            pendingSection.className = 'pending-coaches-section mb-4';
            pendingSection.innerHTML = `
                <div class="card border-warning">
                    <div class="card-header bg-warning bg-opacity-10">
                        <h6 class="card-title mb-0 text-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            待审批教练 (${coaches.length})
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            ${coaches.map(coach => `
                                <div class="col-md-6 col-lg-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex align-items-start mb-3">
                                                <div class="user-avatar me-3">${(coach.real_name || coach.username).charAt(0)}</div>
                                                <div class="flex-grow-1">
                                                    <h6 class="card-title mb-1">${coach.real_name || coach.username}</h6>
                                                    <p class="text-muted mb-1 small">
                                                        ${coach.gender === 'male' ? '男' : coach.gender === 'female' ? '女' : '未知'}
                                                        ${coach.age ? ' • ' + coach.age + '岁' : ''}
                                                    </p>
                                                    <small class="text-muted">申请时间: ${formatDate(coach.created_at)}</small>
                                                </div>
                                            </div>
                                            <div class="d-flex gap-2">
                                                <button class="btn btn-success btn-sm" onclick="approveCoach(${coach.id}, 'junior')">
                                                    <i class="fas fa-check me-1"></i>通过
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="rejectCoach(${coach.id})">
                                                    <i class="fas fa-times me-1"></i>拒绝
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            // 插入到用户管理页面的开头
            const headerElement = usersPage.querySelector('.d-flex.justify-content-between');
            headerElement.parentNode.insertBefore(pendingSection, headerElement.nextSibling);
        }

        // 显示用户列表
        function displayUsers(users) {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';

            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="fas fa-users fa-2x mb-2 d-block"></i>
                            暂无用户数据
                        </td>
                    </tr>
                `;
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-3">${(user.real_name || user.username).charAt(0)}</div>
                            <div>
                                <div class="fw-semibold">${user.real_name || user.username}</div>
                                <small class="text-muted">${user.username}</small>
                            </div>
                        </div>
                    </td>
                    <td><span class="badge bg-${getUserTypeColor(user.user_type)}">${getUserTypeText(user.user_type)}</span></td>
                    <td>
                        <div>${user.phone || '-'}</div>
                        <small class="text-muted">${user.email || '-'}</small>
                    </td>
                    <td>${formatDate(user.created_at)}</td>
                    <td><span class="badge bg-${getStatusColor(user.status)}">${getStatusText(user.status)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="editUser(${user.id})">编辑</button>
                            <button class="btn btn-outline-${user.status === 'active' ? 'warning' : 'success'}" onclick="toggleUserStatus(${user.id})">
                                ${user.status === 'active' ? '禁用' : '启用'}
                            </button>
                            ${getCurrentUser().user_type === 'super_admin' && user.user_type !== 'super_admin' ? 
                                `<button class="btn btn-outline-info" onclick="showAssignAdminModal(${user.id}, '${user.username}')">设为校区管理员</button>` : ''}
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 更新用户分页
        function updateUsersPagination(data, filters) {
            const pagination = document.getElementById('usersPagination');
            if (!data.pages || data.pages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'block';
            const ul = pagination.querySelector('.pagination');
            ul.innerHTML = '';

            // 上一页
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${data.has_prev ? '' : 'disabled'}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick='loadUsers(${data.current_page - 1})'>上一页</a>`;
            ul.appendChild(prevLi);

            // 页码
            for (let i = 1; i <= data.pages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === data.current_page ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick='loadUsers(${i})'>${i}</a>`;
                ul.appendChild(li);
            }

            // 下一页
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${data.has_next ? '' : 'disabled'}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick='loadUsers(${data.current_page + 1})'>下一页</a>`;
            ul.appendChild(nextLi);
        }

        // 获取用户类型颜色
        function getUserTypeColor(type) {
            const colors = {
                'student': 'success',
                'coach': 'primary',
                'campus_admin': 'warning',
                'super_admin': 'danger'
            };
            return colors[type] || 'secondary';
        }

        // 获取用户类型文本
        function getUserTypeText(type) {
            const types = {
                'student': '学员',
                'coach': '教练',
                'campus_admin': '校区管理员',
                'super_admin': '超级管理员'
            };
            return types[type] || type;
        }

        // 获取状态颜色
        function getStatusColor(status) {
            const colors = {
                'active': 'success',
                'inactive': 'secondary',
                'pending': 'warning'
            };
            return colors[status] || 'secondary';
        }

        // 获取状态文本
        function getStatusText(status) {
            const texts = {
                'active': '活跃',
                'inactive': '非活跃',
                'pending': '待审核'
            };
            return texts[status] || status;
        }

        // 加载财务数据
        function loadFinances() {
            // 模拟财务数据
            document.getElementById('totalIncome').textContent = '¥125,480.00';
            document.getElementById('totalExpenses').textContent = '¥45,200.00';
            document.getElementById('netProfit').textContent = '¥80,280.00';
            document.getElementById('profitMargin').textContent = '64.2%';
        }

        // 其他页面加载函数
        function loadBookings() {
            loadAllBookings();
        }

        // 加载所有预约数据（管理员）
        async function loadAllBookings(page = 1, filters = {}) {
            try {
                let url = '/booking/admin/all-bookings?page=' + page;

                // 添加筛选参数
                if (filters.status) url += '&status=' + filters.status;
                if (filters.campus_id) url += '&campus_id=' + filters.campus_id;
                if (filters.date) url += '&date=' + filters.date;

                const result = await API.get(url);
                if (result.success) {
                    const data = result.data.data;
                    displayAllBookings(data.items || []);
                    updateBookingStats(data.items || []);
                    updateBookingsPagination(data);
                } else {
                    // 如果没有专门的管理员接口，使用通用接口
                    loadBookingsBasic();
                }
            } catch (error) {
                console.error('加载预约数据失败:', error);
                loadBookingsBasic();
            }
        }

        // 基础预约加载（兼容性）
        async function loadBookingsBasic() {
            try {
                const result = await API.get('/booking/my-bookings?per_page=50');
                if (result.success) {
                    const bookings = result.data.data.items || [];
                    displayAllBookings(bookings);
                    updateBookingStats(bookings);
                }
            } catch (error) {
                document.getElementById('allBookingsTable').innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-danger py-4">
                            <i class="fas fa-exclamation-triangle fa-2x mb-2 d-block"></i>
                            加载预约数据失败
                        </td>
                    </tr>
                `;
            }
        }

        // 显示所有预约
        function displayAllBookings(bookings) {
            const tbody = document.getElementById('allBookingsTable');
            tbody.innerHTML = '';

            if (bookings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">
                            <i class="fas fa-calendar-times fa-2x mb-2 d-block"></i>
                            暂无预约数据
                        </td>
                    </tr>
                `;
                return;
            }

            bookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${booking.id}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-2">${(booking.student?.real_name || booking.student?.username || '未知').charAt(0)}</div>
                            <div>
                                <div class="fw-semibold small">${booking.student?.real_name || booking.student?.username || '未知'}</div>
                                <small class="text-muted">${booking.student?.username || ''}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-2">${(booking.coach?.real_name || booking.coach?.username || '未知').charAt(0)}</div>
                            <div>
                                <div class="fw-semibold small">${booking.coach?.real_name || booking.coach?.username || '未知'}</div>
                                <small class="text-muted">${booking.coach?.username || ''}</small>
                            </div>
                        </div>
                    </td>
                    <td>${booking.campus?.name || '未知校区'}</td>
                    <td>
                        <div>${formatDate(booking.booking_date)}</div>
                        <small class="text-muted">${booking.start_time} - ${booking.end_time}</small>
                    </td>
                    <td>${booking.table?.table_number || '待分配'}</td>
                    <td><strong class="text-success">${formatCurrency(booking.lesson_fee)}</strong></td>
                    <td><span class="badge bg-${getBookingStatusColor(booking.status)}">${getBookingStatusText(booking.status)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            ${booking.status === 'pending' ?
                                `<button class="btn btn-outline-success" onclick="approveBooking(${booking.id})" title="确认预约">
                                    <i class="fas fa-check"></i>
                                </button>` : ''
                            }
                            ${booking.status === 'pending' || booking.status === 'confirmed' ?
                                `<button class="btn btn-outline-danger" onclick="cancelAdminBooking(${booking.id})" title="取消预约">
                                    <i class="fas fa-times"></i>
                                </button>` : ''
                            }
                            <button class="btn btn-outline-info" onclick="viewBookingDetail(${booking.id})" title="查看详情">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 更新预约统计
        function updateBookingStats(bookings) {
            const stats = {
                pending: 0,
                confirmed: 0,
                completed: 0,
                totalRevenue: 0
            };

            bookings.forEach(booking => {
                if (booking.status === 'pending') stats.pending++;
                if (booking.status === 'confirmed') stats.confirmed++;
                if (booking.status === 'completed') {
                    stats.completed++;
                    stats.totalRevenue += parseFloat(booking.lesson_fee || 0);
                }
            });

            document.getElementById('pendingBookingsCount').textContent = stats.pending;
            document.getElementById('confirmedBookingsCount').textContent = stats.confirmed;
            document.getElementById('completedBookingsCount').textContent = stats.completed;
            document.getElementById('totalBookingRevenue').textContent = formatCurrency(stats.totalRevenue);
        }

        // 获取预约状态颜色
        function getBookingStatusColor(status) {
            const colors = {
                'pending': 'warning',
                'confirmed': 'success',
                'completed': 'info',
                'cancelled': 'danger'
            };
            return colors[status] || 'secondary';
        }

        // 获取预约状态文本
        function getBookingStatusText(status) {
            const texts = {
                'pending': '待确认',
                'confirmed': '已确认',
                'completed': '已完成',
                'cancelled': '已取消'
            };
            return texts[status] || status;
        }

        // 筛选预约
        function filterAllBookings() {
            const filters = {
                status: document.getElementById('filterBookingStatus').value,
                campus_id: document.getElementById('filterBookingCampus').value,
                date: document.getElementById('filterBookingDate').value
            };
            loadAllBookings(1, filters);
        }

        // 刷新预约
        function refreshBookings() {
            showToast('正在刷新预约数据...', 'info');
            loadAllBookings();
        }

        // 导出预约
        function exportBookings() {
            showToast('预约数据导出功能正在开发中', 'info');
        }

        // 管理员确认预约
        async function approveBooking(bookingId) {
            if (!confirm('确定要确认这个预约吗？')) return;

            try {
                const result = await API.post(`/booking/${bookingId}/approve`);
                if (result.success) {
                    showToast('预约已确认', 'success');
                    loadAllBookings();
                } else {
                    showToast(result.message || '确认预约失败', 'error');
                }
            } catch (error) {
                showToast('确认预约失败', 'error');
            }
        }

        // 管理员取消预约
        async function cancelAdminBooking(bookingId) {
            const reason = prompt('请输入取消原因（可选）：') || '管理员取消';
            if (!confirm(`确定要取消这个预约吗？\n原因：${reason}`)) return;

            try {
                const result = await API.post(`/booking/${bookingId}/admin-cancel`, { reason });
                if (result.success) {
                    showToast('预约已取消', 'success');
                    loadAllBookings();
                } else {
                    showToast(result.message || '取消预约失败', 'error');
                }
            } catch (error) {
                showToast('取消预约失败', 'error');
            }
        }

        // 查看预约详情
        function viewBookingDetail(bookingId) {
            showToast('预约详情功能正在开发中', 'info');
        }

        // 更新预约分页
        function updateBookingsPagination(data) {
            const pagination = document.getElementById('bookingsPagination');
            if (!data.pages || data.pages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'block';
            const ul = pagination.querySelector('.pagination');
            ul.innerHTML = '';

            // 上一页
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${data.has_prev ? '' : 'disabled'}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="loadAllBookings(${data.current_page - 1})">上一页</a>`;
            ul.appendChild(prevLi);

            // 页码
            for (let i = 1; i <= data.pages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === data.current_page ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="loadAllBookings(${i})">${i}</a>`;
                ul.appendChild(li);
            }

            // 下一页
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${data.has_next ? '' : 'disabled'}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="loadAllBookings(${data.current_page + 1})">下一页</a>`;
            ul.appendChild(nextLi);
        }

        function loadMatches() {
            loadAllMatches();
        }

        // 加载所有比赛数据（管理员）
        async function loadAllMatches(page = 1, filters = {}) {
            try {
                let url = '/match/admin/all-matches?page=' + page;

                // 添加筛选参数
                if (filters.status) url += '&status=' + filters.status;
                if (filters.campus_id) url += '&campus_id=' + filters.campus_id;
                if (filters.date) url += '&date=' + filters.date;

                const result = await API.get(url);
                if (result.success) {
                    const data = result.data.data;
                    displayAllMatches(data.items || []);
                    updateMatchStats(data.items || []);
                    updateMatchesPagination(data);
                } else {
                    // 如果没有专门的管理员接口，使用通用接口
                    loadMatchesBasic();
                }
            } catch (error) {
                console.error('加载比赛数据失败:', error);
                loadMatchesBasic();
            }
        }

        // 基础比赛加载（兼容性）
        async function loadMatchesBasic() {
            try {
                const result = await API.get('/match/list?per_page=50');
                if (result.success) {
                    const matches = result.data.data.items || [];
                    displayAllMatches(matches);
                    updateMatchStats(matches);
                }
            } catch (error) {
                document.getElementById('allMatchesTable').innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-danger py-4">
                            <i class="fas fa-exclamation-triangle fa-2x mb-2 d-block"></i>
                            加载比赛数据失败
                        </td>
                    </tr>
                `;
            }
        }

        // 显示所有比赛
        function displayAllMatches(matches) {
            const tbody = document.getElementById('allMatchesTable');
            tbody.innerHTML = '';

            if (matches.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">
                            <i class="fas fa-trophy fa-2x mb-2 d-block"></i>
                            暂无比赛数据
                        </td>
                    </tr>
                `;
                return;
            }

            matches.forEach(match => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${match.id}</td>
                    <td>
                        <div class="fw-semibold">${match.name}</div>
                        <small class="text-muted">${match.match_type === 'singles' ? '单打' : match.match_type === 'doubles' ? '双打' : '混合'}</small>
                    </td>
                    <td>${match.campus?.name || '未知校区'}</td>
                    <td>
                        <div>${formatDate(match.match_date)}</div>
                        <small class="text-muted">${match.match_time || '全天'}</small>
                    </td>
                    <td>
                        <div>${formatDate(match.registration_end)}</div>
                        <small class="text-muted ${new Date(match.registration_end) < new Date() ? 'text-danger' : 'text-success'}">
                            ${new Date(match.registration_end) < new Date() ? '已截止' : '可报名'}
                        </small>
                    </td>
                    <td><strong class="text-success">${formatCurrency(match.registration_fee)}</strong></td>
                    <td>
                        <span class="badge bg-info">${match.participants_count || 0}</span>
                        / <small class="text-muted">${match.max_participants || '无限制'}</small>
                    </td>
                    <td><span class="badge bg-${getMatchStatusColor(match.status)}">${getMatchStatusText(match.status)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            ${match.status === 'upcoming' || match.status === 'registration' ?
                                `<button class="btn btn-outline-warning" onclick="startMatch(${match.id})" title="开始比赛">
                                    <i class="fas fa-play"></i>
                                </button>` : ''
                            }
                            ${match.status !== 'completed' ?
                                `<button class="btn btn-outline-danger" onclick="cancelMatch(${match.id})" title="取消比赛">
                                    <i class="fas fa-ban"></i>
                                </button>` : ''
                            }
                            <button class="btn btn-outline-info" onclick="viewMatchDetail(${match.id})" title="查看详情">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-primary" onclick="editMatch(${match.id})" title="编辑比赛">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 更新比赛统计
        function updateMatchStats(matches) {
            const stats = {
                upcoming: 0,
                registration: 0,
                ongoing: 0,
                totalParticipants: 0
            };

            matches.forEach(match => {
                if (match.status === 'upcoming') stats.upcoming++;
                if (match.status === 'registration') stats.registration++;
                if (match.status === 'ongoing') stats.ongoing++;
                stats.totalParticipants += parseInt(match.participants_count || 0);
            });

            document.getElementById('upcomingMatchesCount').textContent = stats.upcoming;
            document.getElementById('registrationMatchesCount').textContent = stats.registration;
            document.getElementById('ongoingMatchesCount').textContent = stats.ongoing;
            document.getElementById('totalParticipants').textContent = stats.totalParticipants;
        }

        // 获取比赛状态颜色
        function getMatchStatusColor(status) {
            const colors = {
                'upcoming': 'info',
                'registration': 'success',
                'ongoing': 'warning',
                'completed': 'secondary',
                'cancelled': 'danger'
            };
            return colors[status] || 'secondary';
        }

        // 获取比赛状态文本
        function getMatchStatusText(status) {
            const texts = {
                'upcoming': '即将开始',
                'registration': '报名中',
                'ongoing': '进行中',
                'completed': '已结束',
                'cancelled': '已取消'
            };
            return texts[status] || status;
        }

        // 筛选比赛
        function filterAllMatches() {
            const filters = {
                status: document.getElementById('filterMatchStatus').value,
                campus_id: document.getElementById('filterMatchCampus').value,
                date: document.getElementById('filterMatchDate').value
            };
            loadAllMatches(1, filters);
        }

        // 导出比赛
        function exportMatches() {
            showToast('比赛数据导出功能正在开发中', 'info');
        }

        // 显示创建比赛模态框
        function showAddMatchModal() {
            // 加载校区列表
            loadCampusForSelect('matchCampusId');

            // 设置默认日期
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);

            document.getElementById('registrationEnd').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('matchDate').value = nextWeek.toISOString().split('T')[0];

            new bootstrap.Modal(document.getElementById('addMatchModal')).show();
        }

        // 提交创建比赛
        async function submitAddMatch() {
            const matchData = {
                name: document.getElementById('matchName').value,
                campus_id: parseInt(document.getElementById('matchCampusId').value),
                match_date: document.getElementById('matchDate').value,
                match_time: document.getElementById('matchTime').value || '09:00',
                registration_end: document.getElementById('registrationEnd').value,
                registration_fee: parseFloat(document.getElementById('registrationFee').value),
                max_participants: parseInt(document.getElementById('maxParticipants').value) || null,
                match_type: document.getElementById('matchType').value,
                description: document.getElementById('matchDescription').value,
                prize_info: document.getElementById('prizeInfo').value
            };

            // 基本验证
            if (!matchData.name || !matchData.campus_id || !matchData.match_date ||
                !matchData.registration_end || isNaN(matchData.registration_fee)) {
                showToast('请填写所有必填字段', 'warning');
                return;
            }

            // 验证日期逻辑
            const regEndDate = new Date(matchData.registration_end);
            const matchDate = new Date(matchData.match_date);
            if (regEndDate >= matchDate) {
                showToast('报名截止日期必须早于比赛日期', 'warning');
                return;
            }

            try {
                const result = await API.post('/match/create', matchData);
                if (result.success) {
                    showToast('比赛创建成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addMatchModal')).hide();
                    loadAllMatches();

                    // 清空表单
                    document.getElementById('addMatchForm').reset();
                } else {
                    showToast(result.message || '创建比赛失败', 'error');
                }
            } catch (error) {
                showToast('创建比赛失败', 'error');
            }
        }

        // 开始比赛
        async function startMatch(matchId) {
            if (!confirm('确定要开始这个比赛吗？开始后将无法继续报名。')) return;

            try {
                const result = await API.post(`/match/${matchId}/start`);
                if (result.success) {
                    showToast('比赛已开始', 'success');
                    loadAllMatches();
                } else {
                    showToast(result.message || '开始比赛失败', 'error');
                }
            } catch (error) {
                showToast('开始比赛失败', 'error');
            }
        }

        // 取消比赛
        async function cancelMatch(matchId) {
            const reason = prompt('请输入取消原因：');
            if (!reason) return;

            if (!confirm(`确定要取消这个比赛吗？\n原因：${reason}\n\n注意：已报名的参赛者会收到通知，报名费将自动退还。`)) return;

            try {
                const result = await API.post(`/match/${matchId}/cancel`, { reason });
                if (result.success) {
                    showToast('比赛已取消，报名费将自动退还', 'success');
                    loadAllMatches();
                } else {
                    showToast(result.message || '取消比赛失败', 'error');
                }
            } catch (error) {
                showToast('取消比赛失败', 'error');
            }
        }

        // 查看比赛详情
        function viewMatchDetail(matchId) {
            showToast('比赛详情功能正在开发中', 'info');
        }

        // 编辑比赛
        function editMatch(matchId) {
            showToast('编辑比赛功能正在开发中', 'info');
        }

        // 更新比赛分页
        function updateMatchesPagination(data) {
            const pagination = document.getElementById('matchesPagination');
            if (!data.pages || data.pages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'block';
            const ul = pagination.querySelector('.pagination');
            ul.innerHTML = '';

            // 上一页
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${data.has_prev ? '' : 'disabled'}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="loadAllMatches(${data.current_page - 1})">上一页</a>`;
            ul.appendChild(prevLi);

            // 页码
            for (let i = 1; i <= data.pages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === data.current_page ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="loadAllMatches(${i})">${i}</a>`;
                ul.appendChild(li);
            }

            // 下一页
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${data.has_next ? '' : 'disabled'}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="loadAllMatches(${data.current_page + 1})">下一页</a>`;
            ul.appendChild(nextLi);
        }

        async function loadCampus() {
            try {
                const result = await API.get('/user/campus');
                if (result.success) {
                    // API返回的数据可能直接在result.data中，而不是result.data.data
                    const campuses = result.data.data || result.data || [];
                    displayCampusList(campuses);
                } else {
                    showToast('加载校区列表失败', 'error');
                }
            } catch (error) {
                console.error('加载校区列表失败:', error);
                showToast('加载校区列表失败', 'error');
            }
        }

        // 显示校区列表
        function displayCampusList(campuses) {
            const campusPage = document.getElementById('campusPage');
            const existingCard = campusPage.querySelector('.campus-list-card');

            if (existingCard) {
                existingCard.remove();
            }

            const campusListCard = document.createElement('div');
            campusListCard.className = 'campus-list-card card';
            campusListCard.innerHTML = `
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>校区名称</th>
                                    <th>地址</th>
                                    <th>联系人</th>
                                    <th>联系电话</th>
                                    <th>类型</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="campusTableBody">
                                ${campuses.length === 0 ?
                                    `<tr><td colspan="6" class="text-center text-muted py-4">
                                        <i class="fas fa-building fa-2x mb-2 d-block"></i>
                                        暂无校区数据
                                    </td></tr>` :
                                    campuses.map(campus => `
                                        <tr>
                                            <td>
                                                <div class="fw-semibold">${campus.name}</div>
                                                <small class="text-muted">ID: ${campus.id}</small>
                                            </td>
                                            <td>${campus.address || '-'}</td>
                                            <td>
                                                <div>${campus.contact_person || '-'}</div>
                                                <small class="text-muted">${campus.contact_email || ''}</small>
                                            </td>
                                            <td>${campus.contact_phone || '-'}</td>
                                            <td>
                                                <span class="badge bg-${campus.campus_type === 'center' ? 'primary' : 'secondary'}">
                                                    ${campus.campus_type === 'center' ? '总部' : '分校'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-primary" onclick="editCampus(${campus.id})">
                                                        <i class="fas fa-edit"></i> 编辑
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteCampus(${campus.id}, '${campus.name}')">
                                                        <i class="fas fa-trash"></i> 删除
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // 找到现有的占位卡片并替换
            const placeholderCard = campusPage.querySelector('.card');
            if (placeholderCard) {
                placeholderCard.parentNode.replaceChild(campusListCard, placeholderCard);
            } else {
                campusPage.appendChild(campusListCard);
            }
        }

        function loadSystem() {
            // 系统管理页面无需额外加载
        }

        // 工具函数
        function showAddUserModal() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'addUserModal';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">添加用户</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addUserForm">
                                <div class="mb-3">
                                    <label class="form-label">用户名 *</label>
                                    <input type="text" class="form-control" id="newUsername" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">密码 *</label>
                                    <input type="password" class="form-control" id="newPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">真实姓名 *</label>
                                    <input type="text" class="form-control" id="newRealName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">用户类型 *</label>
                                    <select class="form-select" id="newUserType" required>
                                        <option value="">请选择用户类型</option>
                                        <option value="student">学员</option>
                                        <option value="coach">教练</option>
                                        <option value="campus_admin">校区管理员</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">校区 *</label>
                                    <select class="form-select" id="newCampusId" required>
                                        <option value="">请选择校区</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">性别</label>
                                    <select class="form-select" id="newGender">
                                        <option value="">请选择性别</option>
                                        <option value="male">男</option>
                                        <option value="female">女</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">手机号</label>
                                    <input type="tel" class="form-control" id="newPhone">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">邮箱</label>
                                    <input type="email" class="form-control" id="newEmail">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" onclick="submitAddUser()">添加</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // 加载校区列表
            loadCampusForSelect('newCampusId');

            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();

            // 当模态框隐藏时移除DOM元素
            modal.addEventListener('hidden.bs.modal', function () {
                document.body.removeChild(modal);
            });
        }

        // 为选择框加载校区列表
        async function loadCampusForSelect(selectId) {
            try {
                const result = await API.get('/user/campus');
                if (result.success) {
                    const select = document.getElementById(selectId);
                    const campuses = result.data.data || result.data || [];
                    campuses.forEach(campus => {
                        const option = document.createElement('option');
                        option.value = campus.id;
                        option.textContent = campus.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('加载校区列表失败:', error);
            }
        }

        // 提交添加用户
        async function submitAddUser() {
            const userData = {
                username: document.getElementById('newUsername').value,
                password: document.getElementById('newPassword').value,
                real_name: document.getElementById('newRealName').value,
                user_type: document.getElementById('newUserType').value,
                campus_id: parseInt(document.getElementById('newCampusId').value),
                gender: document.getElementById('newGender').value,
                phone: document.getElementById('newPhone').value,
                email: document.getElementById('newEmail').value
            };

            // 基本验证
            if (!userData.username || !userData.password || !userData.real_name ||
                !userData.user_type || !userData.campus_id) {
                showToast('请填写所有必填字段', 'warning');
                return;
            }

            try {
                const result = await API.post('/auth/register', userData);
                if (result.success) {
                    showToast('用户添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
                    loadUsers(); // 重新加载用户列表
                } else {
                    showToast(result.message || '添加失败', 'error');
                }
            } catch (error) {
                showToast('添加用户失败', 'error');
            }
        }

        function exportUsers() {
            // 实现用户数据导出功能
            showToast('用户数据导出功能正在开发中', 'info');
        }

        function editUser(userId) {
            showToast(`编辑用户功能正在开发中 (用户ID: ${userId})`, 'info');
        }

        function toggleUserStatus(userId) {
            showToast(`切换用户状态功能正在开发中 (用户ID: ${userId})`, 'info');
        }

        /**
         * 功能：显示一个用于指派校区管理员的模态框（弹窗）。
         * @param {number} userId - 要被指派的用户的ID。
         * @param {string} username - 要被指派的用户的名称。
         */
        function showAssignAdminModal(userId, username) {
            // 动态创建模态框的 DOM 元素
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'assignAdminModal'; // 给一个固定的ID，方便后续通过ID找到它
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">指派校区管理员</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>将用户 <strong>${username}</strong> 指派为校区管理员。</p>
                            <div class="mb-3">
                                <label class="form-label">选择校区</label>
                                <select class="form-select" id="assignCampusId" required>
                                    <option value="">请选择校区</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" onclick="assignCampusAdmin(${userId})">确认</button>
                        </div>
                    </div>
                </div>
            `;

            // 将创建的模态框添加到 body 中
            document.body.appendChild(modal);

            // 调用另一个函数来加载校区列表到下拉框中
            loadCampusForSelect('assignCampusId');

            // 使用 Bootstrap 的 JS API 来初始化并显示模态框
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();

            // 监听模态框关闭事件，关闭后从 DOM 中移除该元素，避免页面污染
            modal.addEventListener('hidden.bs.modal', function () {
                document.body.removeChild(modal);
            });
        }

        /**
         * 功能：向服务器发送请求，将用户指派为校区管理员。
         * @param {number} userId - 用户的ID。
         */
        async function assignCampusAdmin(userId) {
            const campusId = document.getElementById('assignCampusId').value;
            if (!campusId) {
                showToast('请选择一个校区', 'warning');
                return;
            }

            try {
                const result = await API.post(`/user/${userId}/assign-campus-admin`, { campus_id: parseInt(campusId) });
                if (result.success) {
                    showToast('已成功指派校区管理员', 'success');
                    
                    // 安全地获取并关闭模态框
                    const modalElement = document.getElementById('assignAdminModal');
                    if (modalElement) {
                        const modalInstance = bootstrap.Modal.getInstance(modalElement);
                        if (modalInstance) {
                            modalInstance.hide();
                        }
                    }
                    loadUsers(); // 重新加载用户列表以更新状态
                } else {
                    showToast(result.message || '指派失败', 'error');
                }
            } catch (error) {
                console.error('Assign campus admin failed:', error); // 在控制台打印详细错误
                showToast('指派失败，请查看控制台获取更多信息', 'error');
            }
        }

        /**
         * 功能：将用户列表导出为 CSV 文件 (目前为模拟功能)。
         */
        async function exportUsersToCSV() {
            try {
                const table = document.getElementById('userTable'); // 确保页面有 id="userTable" 的表格
                if (!table) {
                    showToast('找不到用户数据表格', 'error');
                    return;
                }

                const rows = table.querySelectorAll('tr');

                // 如果表格只有表头或没有数据
                if (rows.length <= 1) {
                    showToast('没有数据可导出', 'warning');
                    return;
                }

                // CSV 表头
                let csvContent = '用户名,真实姓名,用户类型,手机号,邮箱,注册时间,状态\n';

                // --- 模拟导出 ---
                showToast('正在导出用户数据...', 'info');

                // 实际功能待开发
                setTimeout(() => {
                    showToast('用户数据导出功能正在开发中', 'info');
                }, 1000);

            } catch (error) {
                console.error('Export failed:', error); // 在控制台打印详细错误
                showToast('导出失败，请查看控制台获取更多信息', 'error');
            }
        }

        function filterUsers() {
            // 实现用户筛选功能
            const userType = document.getElementById('filterUserType').value;
            const status = document.getElementById('filterStatus').value;
            const searchText = document.getElementById('searchUser').value;

            showToast('正在筛选用户...', 'info');

            // 重新加载用户数据时应用筛选条件
            loadUsersWithFilter(userType, status, searchText);
        }

        // 带筛选条件加载用户
        async function loadUsersWithFilter(userType = '', status = '', searchText = '') {
            try {
                let url = '/user/students';
                const params = new URLSearchParams();

                if (searchText) {
                    params.append('name', searchText);
                }

                if (params.toString()) {
                    url += '?' + params.toString();
                }

                const result = await API.get(url);
                let users = [];

                if (result.success) {
                    users = result.data.data.items || [];

                    // 客户端筛选（实际项目中应该在服务器端筛选）
                    if (userType) {
                        users = users.filter(user => user.user_type === userType);
                    }
                    if (status) {
                        users = users.filter(user => user.status === status);
                    }
                }

                displayUsers(users);
                loadPendingCoaches();
            } catch (error) {
                console.error('筛选用户失败:', error);
                showToast('筛选用户失败', 'error');
            }
        }

        function editUser(userId) {
            showToast('功能正在开发中', 'info');
        }

        function toggleUserStatus(userId) {
            showToast('功能正在开发中', 'info');
        }

        function exportFinanceReport() {
            showToast('功能正在开发中', 'info');
        }

        function showAddCampusModal() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'addCampusModal';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">添加校区</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addCampusForm">
                                <div class="mb-3">
                                    <label class="form-label">校区名称 *</label>
                                    <input type="text" class="form-control" id="campusName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">地址 *</label>
                                    <textarea class="form-control" id="campusAddress" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">联系人</label>
                                    <input type="text" class="form-control" id="contactPerson">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">联系电话</label>
                                    <input type="tel" class="form-control" id="contactPhone">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">联系邮箱</label>
                                    <input type="email" class="form-control" id="contactEmail">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">校区类型</label>
                                    <select class="form-select" id="campusType">
                                        <option value="branch">分校</option>
                                        <option value="center">总部</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" onclick="submitAddCampus()">添加</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();

            // 当模态框隐藏时移除DOM元素
            modal.addEventListener('hidden.bs.modal', function () {
                document.body.removeChild(modal);
            });
        }

        // 提交添加校区
        async function submitAddCampus() {
            const form = document.getElementById('addCampusForm');
            const formData = new FormData(form);

            const campusData = {
                name: document.getElementById('campusName').value,
                address: document.getElementById('campusAddress').value,
                contact_person: document.getElementById('contactPerson').value,
                contact_phone: document.getElementById('contactPhone').value,
                contact_email: document.getElementById('contactEmail').value,
                campus_type: document.getElementById('campusType').value
            };

            if (!campusData.name || !campusData.address) {
                showToast('请填写校区名称和地址', 'warning');
                return;
            }

            try {
                const result = await API.post('/user/campus', campusData);
                if (result.success) {
                    showToast('校区添加成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addCampusModal')).hide();
                    loadCampus(); // 重新加载校区列表
                } else {
                    showToast(result.message || '添加失败', 'error');
                }
            } catch (error) {
                showToast('添加校区失败', 'error');
            }
        }

        // 编辑校区
        async function editCampus(campusId) {
            try {
                // 先获取校区信息
                const campuses = await API.get('/user/campus');
                const campus = campuses.data.find(c => c.id === campusId);

                if (!campus) {
                    showToast('校区信息不存在', 'error');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'editCampusModal';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">编辑校区</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editCampusForm">
                                    <div class="mb-3">
                                        <label class="form-label">校区名称 *</label>
                                        <input type="text" class="form-control" id="editCampusName" value="${campus.name}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">地址 *</label>
                                        <textarea class="form-control" id="editCampusAddress" rows="3" required>${campus.address || ''}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">联系人</label>
                                        <input type="text" class="form-control" id="editContactPerson" value="${campus.contact_person || ''}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">联系电话</label>
                                        <input type="tel" class="form-control" id="editContactPhone" value="${campus.contact_phone || ''}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">联系邮箱</label>
                                        <input type="email" class="form-control" id="editContactEmail" value="${campus.contact_email || ''}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">校区类型</label>
                                        <select class="form-select" id="editCampusType">
                                            <option value="branch" ${campus.campus_type === 'branch' ? 'selected' : ''}>分校</option>
                                            <option value="center" ${campus.campus_type === 'center' ? 'selected' : ''}>总部</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="submitEditCampus(${campusId})">保存</button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();

                // 当模态框隐藏时移除DOM元素
                modal.addEventListener('hidden.bs.modal', function () {
                    document.body.removeChild(modal);
                });
            } catch (error) {
                showToast('获取校区信息失败', 'error');
            }
        }

        // 提交编辑校区
        async function submitEditCampus(campusId) {
            const campusData = {
                name: document.getElementById('editCampusName').value,
                address: document.getElementById('editCampusAddress').value,
                contact_person: document.getElementById('editContactPerson').value,
                contact_phone: document.getElementById('editContactPhone').value,
                contact_email: document.getElementById('editContactEmail').value,
                campus_type: document.getElementById('editCampusType').value
            };

            if (!campusData.name || !campusData.address) {
                showToast('请填写校区名称和地址', 'warning');
                return;
            }

            try {
                const result = await API.put(`/user/campus/${campusId}`, campusData);
                if (result.success) {
                    showToast('校区信息更新成功', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('editCampusModal')).hide();
                    loadCampus(); // 重新加载校区列表
                } else {
                    showToast(result.message || '更新失败', 'error');
                }
            } catch (error) {
                showToast('更新校区失败', 'error');
            }
        }

        // 删除校区
        async function deleteCampus(campusId, campusName) {
            if (!confirm(`确定要删除校区"${campusName}"吗？\n\n注意：只有没有用户的校区才能被删除。`)) {
                return;
            }

            try {
                const result = await API.delete(`/user/campus/${campusId}`);
                if (result.success) {
                    showToast('校区删除成功', 'success');
                    loadCampus(); // 重新加载校区列表
                } else {
                    showToast(result.message || '删除失败', 'error');
                }
            } catch (error) {
                showToast('删除校区失败', 'error');
            }
        }

        function showSystemConfig() {
            showToast('功能正在开发中', 'info');
        }

        function viewSystemLogs() {
            showToast('功能正在开发中', 'info');
        }

        function backupDatabase() {
            if (confirm('确定要执行数据库备份吗？')) {
                showToast('数据库备份已开始', 'info');
            }
        }

        function clearCache() {
            if (confirm('确定要清除系统缓存吗？')) {
                showToast('缓存清除成功', 'success');
            }
        }

        // 审批教练申请
        async function approveCoach(coachId, coachLevel = 'junior') {
            if (!confirm('确定要通过这个教练申请吗？')) {
                return;
            }

            try {
                const result = await API.post(`/user/coach-applications/${coachId}/approve`, {
                    approve: true,
                    coach_level: coachLevel
                });

                if (result.success) {
                    showToast('教练申请已通过', 'success');
                    loadPendingCoaches(); // 重新加载待审批教练
                    loadUsers(); // 重新加载用户列表
                } else {
                    showToast(result.message || '审批失败', 'error');
                }
            } catch (error) {
                console.error('审批教练失败:', error);
                showToast('审批操作失败', 'error');
            }
        }

        // 拒绝教练申请
        async function rejectCoach(coachId) {
            const reason = prompt('请输入拒绝原因（可选）：') || '管理员拒绝';

            if (!confirm(`确定要拒绝这个教练申请吗？\n拒绝原因：${reason}`)) {
                return;
            }

            try {
                const result = await API.post(`/user/coach-applications/${coachId}/approve`, {
                    approve: false,
                    reason: reason
                });

                if (result.success) {
                    showToast('教练申请已拒绝', 'info');
                    loadPendingCoaches(); // 重新加载待审批教练
                } else {
                    showToast(result.message || '操作失败', 'error');
                }
            } catch (error) {
                console.error('拒绝教练失败:', error);
                showToast('操作失败', 'error');
            }
        }
    </script>
</body>
</html>