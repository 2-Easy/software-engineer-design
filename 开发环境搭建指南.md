# 乒乓球培训管理系统 - 开发环境搭建指南

## 📋 环境要求

### 系统要求
- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **内存**: 最低8GB，推荐16GB
- **磁盘空间**: 至少10GB可用空间

### 软件依赖
- **Node.js**: v18.0.0+ (推荐 LTS 版本)
- **npm**: v8.0.0+ 或 **yarn**: v1.22.0+
- **PostgreSQL**: v14.0+
- **Redis**: v6.0+
- **Git**: v2.30.0+
- **Docker**: v20.0+ (可选，推荐)

## 🚀 快速开始

### 方式一：Docker 一键启动 (推荐)

```bash
# 1. 克隆项目
git clone https://github.com/your-org/table-tennis-management.git
cd table-tennis-management

# 2. 启动所有服务
docker-compose up -d

# 3. 等待服务启动完成
docker-compose logs -f

# 4. 访问应用
# 前端: http://localhost:3000
# 后端: http://localhost:5000
# 数据库: localhost:5432
```

### 方式二：本地开发环境

## 🔧 详细安装步骤

### 1. 安装 Node.js

#### Windows
```bash
# 使用 Chocolatey
choco install nodejs

# 或从官网下载
# https://nodejs.org/
```

#### macOS
```bash
# 使用 Homebrew
brew install node

# 或使用 nvm (推荐)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18
```

#### Linux (Ubuntu)
```bash
# 使用 NodeSource
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 或使用 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18
```

### 2. 安装 PostgreSQL

#### Windows
```bash
# 使用 Chocolatey
choco install postgresql

# 或从官网下载
# https://www.postgresql.org/download/windows/
```

#### macOS
```bash
# 使用 Homebrew
brew install postgresql
brew services start postgresql

# 创建数据库用户
createuser -s postgres
```

#### Linux (Ubuntu)
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 设置postgres用户密码
sudo -u postgres psql
\password postgres
\q
```

### 3. 安装 Redis

#### Windows
```bash
# 使用 WSL2 + Ubuntu，然后:
sudo apt install redis-server
sudo service redis-server start
```

#### macOS
```bash
brew install redis
brew services start redis
```

#### Linux (Ubuntu)
```bash
sudo apt install redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

### 4. 安装开发工具

#### Git
```bash
# Windows (Chocolatey)
choco install git

# macOS (Homebrew)
brew install git

# Linux (Ubuntu)
sudo apt install git
```

#### Docker (可选但推荐)
```bash
# Windows: 下载 Docker Desktop
# https://www.docker.com/products/docker-desktop

# macOS:
brew install --cask docker

# Linux:
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

## 📦 项目初始化

### 1. 克隆项目
```bash
git clone https://github.com/your-org/table-tennis-management.git
cd table-tennis-management
```

### 2. 安装依赖

#### 后端依赖
```bash
cd backend
npm install

# 或使用 yarn
yarn install
```

#### 前端依赖
```bash
cd ../frontend
npm install

# 或使用 yarn
yarn install
```

### 3. 环境变量配置

#### 后端环境变量 (.env)
```bash
# 创建环境变量文件
cd backend
cp .env.example .env

# 编辑 .env 文件
nano .env
```

```env
# .env 文件内容
NODE_ENV=development
PORT=5000

# 数据库配置
DATABASE_URL="postgresql://postgres:password@localhost:5432/ttms_dev"

# Redis配置
REDIS_URL="redis://localhost:6379"

# JWT配置
JWT_SECRET="your-super-secret-jwt-key-change-in-production"
JWT_EXPIRES_IN="7d"

# 文件上传配置
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE="5242880"

# 支付配置 (开发环境使用沙箱)
WECHAT_PAY_APP_ID="your-wechat-app-id"
WECHAT_PAY_MCH_ID="your-wechat-mch-id"
WECHAT_PAY_API_KEY="your-wechat-api-key"

ALIPAY_APP_ID="your-alipay-app-id"
ALIPAY_PRIVATE_KEY="your-alipay-private-key"

# 邮件配置
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-app-password"

# 短信配置
SMS_ACCESS_KEY="your-sms-access-key"
SMS_ACCESS_SECRET="your-sms-access-secret"
```

#### 前端环境变量 (.env)
```bash
# 创建环境变量文件
cd ../frontend
cp .env.example .env

# 编辑 .env 文件
nano .env
```

```env
# .env 文件内容
VITE_API_BASE_URL=http://localhost:5000/api
VITE_SOCKET_URL=http://localhost:5000
VITE_UPLOAD_URL=http://localhost:5000/uploads
```

### 4. 数据库初始化

```bash
cd backend

# 生成 Prisma Client
npx prisma generate

# 运行数据库迁移
npx prisma migrate dev --name init

# 填充种子数据
npx prisma db seed
```

### 5. 验证安装

#### 检查服务状态
```bash
# 检查 PostgreSQL
psql -U postgres -c "SELECT version();"

# 检查 Redis
redis-cli ping

# 检查 Node.js 版本
node --version
npm --version
```

#### 运行测试
```bash
# 后端测试
cd backend
npm test

# 前端测试
cd ../frontend
npm test
```

## 🚀 启动开发服务

### 1. 启动后端服务
```bash
cd backend

# 开发模式启动 (自动重启)
npm run dev

# 或者
yarn dev
```

### 2. 启动前端服务
```bash
# 新开一个终端
cd frontend

# 启动开发服务器
npm run dev

# 或者
yarn dev
```

### 3. 启动数据库服务

#### 使用本地安装
```bash
# PostgreSQL
sudo systemctl start postgresql  # Linux
brew services start postgresql   # macOS

# Redis
sudo systemctl start redis      # Linux
brew services start redis       # macOS
```

#### 使用Docker
```bash
# 启动数据库容器
docker-compose up -d postgres redis
```

## 🛠️ 开发工具配置

### VS Code 配置

#### 推荐插件
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "Prisma.prisma",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "formulahendry.auto-rename-tag",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-json",
    "eamodio.gitlens",
    "rangav.vscode-thunder-client"
  ]
}
```

#### 工作区设置 (.vscode/settings.json)
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  }
}
```

### 代码规范配置

#### Prettier 配置 (.prettierrc)
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

#### ESLint 配置 (.eslintrc.js)
```javascript
module.exports = {
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'prettier'
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint'],
  rules: {
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/no-explicit-any': 'warn',
    'prefer-const': 'error',
    'no-var': 'error'
  }
};
```

## 🐳 Docker 开发环境

### docker-compose.dev.yml
```yaml
version: '3.8'

services:
  # 数据库
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ttms_dev
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backend/prisma/init.sql:/docker-entrypoint-initdb.d/init.sql

  # 缓存
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # 邮件测试服务 (开发用)
  mailhog:
    image: mailhog/mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI

  # 数据库管理工具
  pgadmin:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - "5050:80"
    depends_on:
      - postgres

volumes:
  postgres_data:
  redis_data:
```

### 启动开发环境
```bash
# 启动数据库服务
docker-compose -f docker-compose.dev.yml up -d

# 查看服务状态
docker-compose -f docker-compose.dev.yml ps

# 查看日志
docker-compose -f docker-compose.dev.yml logs -f
```

## 🔍 调试配置

### VS Code 调试配置 (.vscode/launch.json)
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Backend",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/backend/src/index.ts",
      "outFiles": ["${workspaceFolder}/backend/dist/**/*.js"],
      "runtimeArgs": ["-r", "ts-node/register"],
      "env": {
        "NODE_ENV": "development"
      },
      "console": "integratedTerminal",
      "restart": true,
      "protocol": "inspector"
    },
    {
      "name": "Debug Frontend",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}/frontend",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["run", "dev"]
    }
  ]
}
```

## 📝 常用开发命令

### package.json 脚本
```json
{
  "scripts": {
    "dev": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "cd frontend && npm run dev",
    "build": "npm run build:backend && npm run build:frontend",
    "build:backend": "cd backend && npm run build",
    "build:frontend": "cd frontend && npm run build",
    "test": "npm run test:backend && npm run test:frontend",
    "test:backend": "cd backend && npm test",
    "test:frontend": "cd frontend && npm test",
    "db:reset": "cd backend && npx prisma migrate reset",
    "db:seed": "cd backend && npx prisma db seed",
    "db:studio": "cd backend && npx prisma studio"
  }
}
```

### 常用命令
```bash
# 启动完整开发环境
npm run dev

# 重置数据库
npm run db:reset

# 打开数据库管理界面
npm run db:studio

# 运行所有测试
npm test

# 构建生产版本
npm run build

# 查看数据库迁移状态
cd backend && npx prisma migrate status

# 生成新的数据库迁移
cd backend && npx prisma migrate dev --name "your_migration_name"
```

## 🚨 常见问题

### 1. 端口被占用
```bash
# 查看端口占用
lsof -i :3000  # 前端端口
lsof -i :5000  # 后端端口

# 杀死占用进程
kill -9 <PID>
```

### 2. 数据库连接失败
```bash
# 检查PostgreSQL服务状态
sudo systemctl status postgresql

# 重启PostgreSQL
sudo systemctl restart postgresql

# 检查连接
psql -U postgres -h localhost -p 5432 -d ttms_dev
```

### 3. Redis连接失败
```bash
# 检查Redis服务
redis-cli ping

# 重启Redis
sudo systemctl restart redis
```

### 4. 依赖安装失败
```bash
# 清除npm缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules package-lock.json
npm install

# 或使用yarn
rm -rf node_modules yarn.lock
yarn install
```

### 5. Prisma相关问题
```bash
# 重新生成Prisma Client
npx prisma generate

# 重置数据库模式
npx prisma db push --force-reset

# 查看数据库内容
npx prisma studio
```

## 📚 开发资源

### 文档链接
- [React 官方文档](https://react.dev/)
- [TypeScript 官方文档](https://www.typescriptlang.org/)
- [Ant Design 组件库](https://ant.design/)
- [Express.js 文档](https://expressjs.com/)
- [Prisma 文档](https://www.prisma.io/docs/)
- [PostgreSQL 文档](https://www.postgresql.org/docs/)

### 学习资源
- [Node.js 最佳实践](https://github.com/goldbergyoni/nodebestpractices)
- [React 最佳实践](https://github.com/vasanthk/react-bits)
- [TypeScript 深入理解](https://github.com/basarat/typescript-book)

---

**环境搭建完成后，您就可以开始开发了！**

如有问题，请查看项目文档或联系开发团队。