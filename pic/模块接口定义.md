# 乒乓球培训管理系统 - 模块接口定义

## 1. 接口设计原则

本系统采用RESTful API设计原则，遵循统一的接口规范，支持JSON数据格式，实现模块间的松耦合。

## 2. 通用接口规范

### 2.1 HTTP状态码规范

| 状态码 | 说明 | 使用场景 |
|--------|------|----------|
| 200 | 成功 | 请求成功并返回数据 |
| 201 | 创建成功 | 资源创建成功 |
| 400 | 请求错误 | 参数错误或格式错误 |
| 401 | 未授权 | 用户未登录或token无效 |
| 403 | 禁止访问 | 用户权限不足 |
| 404 | 资源不存在 | 请求的资源不存在 |
| 500 | 服务器错误 | 系统内部错误 |

### 2.2 通用响应格式

```json
{
    "code": "响应状态码",
    "message": "响应消息",
    "data": "响应数据",
    "timestamp": "响应时间戳"
}
```

### 2.3 分页请求格式

```json
{
    "page": "页码，从1开始",
    "size": "每页数量，默认10",
    "sort": "排序字段",
    "order": "排序方向，asc/desc"
}
```

## 3. 用户管理模块接口

### 3.1 用户注册接口

#### 学员注册
```
POST /api/user/register/student
Content-Type: application/json

Request:
{
    "username": "用户名",
    "password": "密码",
    "realName": "真实姓名",
    "gender": "性别",
    "age": 年龄,
    "phone": "手机号码",
    "email": "邮箱",
    "campusId": "校区ID"
}

Response:
{
    "code": 201,
    "message": "注册成功",
    "data": {
        "userId": "用户ID",
        "username": "用户名"
    }
}
```

#### 教练注册
```
POST /api/user/register/coach
Content-Type: multipart/form-data

Request:
{
    "username": "用户名",
    "password": "密码",
    "realName": "真实姓名",
    "gender": "性别",
    "age": 年龄,
    "phone": "手机号码",
    "email": "邮箱",
    "campusId": "校区ID",
    "photo": "照片文件",
    "achievements": "成绩描述"
}

Response:
{
    "code": 201,
    "message": "注册申请已提交，等待审核",
    "data": {
        "applicationId": "申请ID"
    }
}
```

### 3.2 用户认证接口

#### 用户登录
```
POST /api/auth/login
Content-Type: application/json

Request:
{
    "username": "用户名",
    "password": "密码"
}

Response:
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "token": "JWT令牌",
        "userInfo": {
            "userId": "用户ID",
            "username": "用户名",
            "realName": "真实姓名",
            "userType": "用户类型",
            "campusId": "校区ID"
        }
    }
}
```

#### 用户登出
```
POST /api/auth/logout
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "登出成功"
}
```

### 3.3 用户信息管理接口

#### 获取用户信息
```
GET /api/user/profile/{userId}
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "userId": "用户ID",
        "username": "用户名",
        "realName": "真实姓名",
        "gender": "性别",
        "age": 年龄,
        "phone": "手机号码",
        "email": "邮箱",
        "campus": {
            "campusId": "校区ID",
            "campusName": "校区名称"
        }
    }
}
```

#### 更新用户信息
```
PUT /api/user/profile/{userId}
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "realName": "真实姓名",
    "gender": "性别",
    "age": 年龄,
    "phone": "手机号码",
    "email": "邮箱"
}

Response:
{
    "code": 200,
    "message": "更新成功"
}
```

## 4. 教练选择管理模块接口

### 4.1 教练查询接口

#### 按条件查询教练
```
GET /api/coach/search
Authorization: Bearer {token}
Parameters:
    name: 教练姓名(可选)
    gender: 性别(可选)
    age: 年龄(可选)
    campusId: 校区ID
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "userId": "教练ID",
                "realName": "教练姓名",
                "gender": "性别",
                "age": 年龄,
                "coachLevel": "教练级别",
                "hourlyRate": 每小时收费,
                "photoUrl": "照片URL",
                "achievements": "成绩描述",
                "currentStudents": 当前学员数
            }
        ],
        "totalElements": 总记录数,
        "totalPages": 总页数
    }
}
```

#### 获取教练详情
```
GET /api/coach/{coachId}
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "userId": "教练ID",
        "realName": "教练姓名",
        "gender": "性别",
        "age": 年龄,
        "coachLevel": "教练级别",
        "hourlyRate": 每小时收费,
        "photoUrl": "照片URL",
        "achievements": "成绩描述",
        "currentStudents": 当前学员数,
        "maxStudents": 最大学员数
    }
}
```

### 4.2 师生关系管理接口

#### 申请选择教练
```
POST /api/relation/apply
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "coachId": "教练ID"
}

Response:
{
    "code": 201,
    "message": "申请已提交",
    "data": {
        "relationId": "关系ID"
    }
}
```

#### 教练审核申请
```
PUT /api/relation/{relationId}/approve
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "approve": true/false,
    "reason": "拒绝原因(可选)"
}

Response:
{
    "code": 200,
    "message": "审核完成"
}
```

#### 查询师生关系
```
GET /api/relation/student/{studentId}
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "relationId": "关系ID",
            "coach": {
                "userId": "教练ID",
                "realName": "教练姓名",
                "coachLevel": "教练级别"
            },
            "status": "关系状态",
            "createTime": "建立时间"
        }
    ]
}
```

## 5. 课程预约管理模块接口

### 5.1 课表查询接口

#### 获取教练课表
```
GET /api/schedule/coach/{coachId}
Authorization: Bearer {token}
Parameters:
    startDate: 开始日期(YYYY-MM-DD)
    endDate: 结束日期(YYYY-MM-DD)

Response:
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "schedule": [
            {
                "date": "日期",
                "slots": [
                    {
                        "startTime": "开始时间",
                        "endTime": "结束时间",
                        "status": "状态(available/booked)",
                        "tableId": "球台ID(如已预约)",
                        "studentName": "学员姓名(如已预约)"
                    }
                ]
            }
        ]
    }
}
```

#### 获取可用球台
```
GET /api/table/available
Authorization: Bearer {token}
Parameters:
    campusId: 校区ID
    date: 日期
    startTime: 开始时间
    endTime: 结束时间

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "tableId": "球台ID",
            "tableNumber": "球台编号",
            "status": "球台状态"
        }
    ]
}
```

### 5.2 预约处理接口

#### 创建预约
```
POST /api/booking/create
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "coachId": "教练ID",
    "date": "预约日期",
    "startTime": "开始时间",
    "endTime": "结束时间",
    "tableId": "球台ID(可选，为空则自动分配)"
}

Response:
{
    "code": 201,
    "message": "预约申请已提交",
    "data": {
        "bookingId": "预约ID",
        "lessonFee": 课时费金额
    }
}
```

#### 确认预约
```
PUT /api/booking/{bookingId}/confirm
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "confirm": true/false,
    "reason": "拒绝原因(可选)"
}

Response:
{
    "code": 200,
    "message": "预约已确认"
}
```

#### 取消预约
```
PUT /api/booking/{bookingId}/cancel
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "reason": "取消原因"
}

Response:
{
    "code": 200,
    "message": "取消申请已提交"
}
```

### 5.3 预约查询接口

#### 查询用户预约记录
```
GET /api/booking/user/{userId}
Authorization: Bearer {token}
Parameters:
    status: 预约状态(可选)
    startDate: 开始日期(可选)
    endDate: 结束日期(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "bookingId": "预约ID",
                "coach": {
                    "userId": "教练ID",
                    "realName": "教练姓名"
                },
                "student": {
                    "userId": "学员ID",
                    "realName": "学员姓名"
                },
                "date": "预约日期",
                "startTime": "开始时间",
                "endTime": "结束时间",
                "table": {
                    "tableId": "球台ID",
                    "tableNumber": "球台编号"
                },
                "status": "预约状态",
                "lessonFee": 课时费
            }
        ]
    }
}
```

## 6. 收费管理模块接口

### 6.1 账户管理接口

#### 获取账户余额
```
GET /api/account/{userId}/balance
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "userId": "用户ID",
        "balance": 账户余额,
        "lastUpdate": "最后更新时间"
    }
}
```

#### 账户充值
```
POST /api/account/deposit
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "amount": 充值金额,
    "paymentMethod": "支付方式(wechat/alipay/offline)"
}

Response:
{
    "code": 200,
    "message": "充值成功",
    "data": {
        "transactionId": "交易ID",
        "balance": 账户余额
    }
}
```

### 6.2 交易记录接口

#### 获取交易记录
```
GET /api/transaction/user/{userId}
Authorization: Bearer {token}
Parameters:
    type: 交易类型(可选)
    startDate: 开始日期(可选)
    endDate: 结束日期(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "transactionId": "交易ID",
                "type": "交易类型",
                "amount": 交易金额,
                "paymentMethod": "支付方式",
                "status": "交易状态",
                "time": "交易时间",
                "relatedBookingId": "关联预约ID"
            }
        ]
    }
}
```

## 7. 比赛管理模块接口

### 7.1 比赛信息接口

#### 创建比赛
```
POST /api/match/create
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "matchName": "比赛名称",
    "matchDate": "比赛日期",
    "registrationStart": "报名开始时间",
    "registrationEnd": "报名结束时间",
    "registrationFee": 报名费
}

Response:
{
    "code": 201,
    "message": "比赛创建成功",
    "data": {
        "matchId": "比赛ID"
    }
}
```

#### 获取比赛列表
```
GET /api/match/list
Authorization: Bearer {token}
Parameters:
    status: 比赛状态(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "matchId": "比赛ID",
                "matchName": "比赛名称",
                "matchDate": "比赛日期",
                "registrationStart": "报名开始时间",
                "registrationEnd": "报名结束时间",
                "registrationFee": 报名费,
                "status": "比赛状态"
            }
        ]
    }
}
```

### 7.2 报名管理接口

#### 学员报名
```
POST /api/match/{matchId}/register
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "group": "分组(甲组/乙组/丙组)"
}

Response:
{
    "code": 201,
    "message": "报名成功",
    "data": {
        "registrationId": "报名ID"
    }
}
```

#### 查询报名信息
```
GET /api/match/{matchId}/registrations
Authorization: Bearer {token}
Parameters:
    group: 分组(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "registrationId": "报名ID",
                "student": {
                    "userId": "学员ID",
                    "realName": "学员姓名"
                },
                "group": "分组",
                "registrationTime": "报名时间",
                "paymentStatus": "缴费状态"
            }
        ]
    }
}
```

## 8. 消息通知模块接口

### 8.1 消息发送接口

#### 发送系统消息
```
POST /api/message/send
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "receiverId": "接收者ID",
    "messageType": "消息类型",
    "title": "消息标题",
    "content": "消息内容",
    "relatedId": "关联业务ID(可选)"
}

Response:
{
    "code": 200,
    "message": "发送成功"
}
```

### 8.2 消息查询接口

#### 获取用户消息
```
GET /api/message/user/{userId}
Authorization: Bearer {token}
Parameters:
    status: 消息状态(可选)
    type: 消息类型(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "messageId": "消息ID",
                "title": "消息标题",
                "content": "消息内容",
                "type": "消息类型",
                "status": "消息状态",
                "sendTime": "发送时间",
                "readTime": "阅读时间"
            }
        ],
        "unreadCount": 未读数量
    }
}
```

#### 标记消息已读
```
PUT /api/message/{messageId}/read
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "标记成功"
}
```

## 9. 系统管理模块接口

### 9.1 校区管理接口

#### 创建校区
```
POST /api/campus/create
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
    "campusName": "校区名称",
    "address": "校区地址",
    "contactPerson": "联系人",
    "contactPhone": "联系电话",
    "contactEmail": "联系邮箱",
    "campusType": "校区类型",
    "managerId": "管理员ID"
}

Response:
{
    "code": 201,
    "message": "校区创建成功",
    "data": {
        "campusId": "校区ID"
    }
}
```

#### 获取校区列表
```
GET /api/campus/list
Authorization: Bearer {token}

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "campusId": "校区ID",
            "campusName": "校区名称",
            "address": "校区地址",
            "contactPerson": "联系人",
            "contactPhone": "联系电话",
            "campusType": "校区类型",
            "manager": {
                "userId": "管理员ID",
                "realName": "管理员姓名"
            }
        }
    ]
}
```

### 9.2 日志管理接口

#### 查询系统日志
```
GET /api/log/system
Authorization: Bearer {token}
Parameters:
    operationType: 操作类型(可选)
    userId: 操作用户ID(可选)
    startDate: 开始日期(可选)
    endDate: 结束日期(可选)
    page: 页码
    size: 每页数量

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "content": [
            {
                "logId": "日志ID",
                "user": {
                    "userId": "用户ID",
                    "realName": "用户姓名"
                },
                "operationType": "操作类型",
                "operationContent": "操作内容",
                "operationTime": "操作时间",
                "ipAddress": "IP地址"
            }
        ]
    }
}
```

## 10. 错误码定义

| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 1001 | 用户名已存在 | 注册时用户名重复 |
| 1002 | 密码格式不正确 | 密码不符合要求 |
| 1003 | 手机号格式不正确 | 手机号格式错误 |
| 1004 | 邮箱格式不正确 | 邮箱格式错误 |
| 2001 | 师生关系已存在 | 重复申请选择教练 |
| 2002 | 教练学员数量已满 | 教练指导学员达到上限 |
| 2003 | 学员教练数量已满 | 学员选择教练达到上限 |
| 3001 | 时间段冲突 | 预约时间冲突 |
| 3002 | 球台已被占用 | 球台在该时间段不可用 |
| 3003 | 账户余额不足 | 余额不足以支付课时费 |
| 3004 | 取消次数超限 | 月度取消次数达到上限 |
| 4001 | 报名已截止 | 比赛报名时间已过 |
| 4002 | 重复报名 | 学员已报名该比赛 |
| 5001 | 权限不足 | 用户权限不足 |
| 5002 | Token无效 | 访问令牌无效或过期 |