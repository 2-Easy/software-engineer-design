# 乒乓球培训管理系统 - 数据字典

## 1. 数据字典概述

数据字典是对系统中所有数据元素的详细定义，包括数据项、数据结构、数据流、数据存储和处理过程的完整描述。

## 2. 数据项定义

### 2.1 用户相关数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 用户ID | user_id | INT | 11 | 自动生成 | 用户唯一标识 |
| 用户名 | username | VARCHAR | 50 | 字母数字组合 | 用户登录名，唯一 |
| 密码 | password | VARCHAR | 255 | 8-16位，含字母数字特殊字符 | 加密存储 |
| 真实姓名 | real_name | VARCHAR | 50 | 中文或英文 | 用户真实姓名 |
| 性别 | gender | ENUM | - | 男/女 | 用户性别 |
| 年龄 | age | INT | 3 | 1-150 | 用户年龄 |
| 电话 | phone | VARCHAR | 20 | 11位手机号 | 联系电话 |
| 邮箱 | email | VARCHAR | 100 | 邮箱格式 | 电子邮箱 |
| 用户类型 | user_type | ENUM | - | 学员/教练员/校区管理员/超级管理员 | 用户角色 |
| 校区ID | campus_id | INT | 11 | 外键关联 | 所属校区 |
| 注册时间 | create_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 注册时间 |
| 状态 | status | ENUM | - | 激活/禁用/待审核 | 账户状态 |

### 2.2 教练员扩展数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 教练级别 | coach_level | ENUM | - | 高级/中级/初级 | 教练员级别 |
| 每小时收费 | hourly_rate | DECIMAL | 10,2 | 正数 | 每小时课时费 |
| 照片路径 | photo_path | VARCHAR | 255 | 文件路径 | 教练员照片 |
| 成绩描述 | achievements | TEXT | - | 文本 | 以往比赛成绩 |
| 最大学员数 | max_students | INT | 3 | 1-20 | 最多指导学员数 |
| 当前学员数 | current_students | INT | 3 | 0-20 | 当前指导学员数 |

### 2.3 校区相关数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 校区ID | campus_id | INT | 11 | 自动生成 | 校区唯一标识 |
| 校区名称 | campus_name | VARCHAR | 100 | 文本 | 校区名称 |
| 地址 | address | VARCHAR | 200 | 文本 | 校区地址 |
| 联系人 | contact_person | VARCHAR | 50 | 文本 | 联系人姓名 |
| 联系电话 | contact_phone | VARCHAR | 20 | 电话格式 | 联系电话 |
| 联系邮箱 | contact_email | VARCHAR | 100 | 邮箱格式 | 联系邮箱 |
| 校区类型 | campus_type | ENUM | - | 中心校区/分校区 | 校区类型 |
| 负责人ID | manager_id | INT | 11 | 外键关联 | 校区管理员ID |

### 2.4 师生关系数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 关系ID | relation_id | INT | 11 | 自动生成 | 师生关系唯一标识 |
| 学员ID | student_id | INT | 11 | 外键关联 | 学员用户ID |
| 教练ID | coach_id | INT | 11 | 外键关联 | 教练用户ID |
| 申请时间 | apply_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 学员申请时间 |
| 审核时间 | approve_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 教练审核时间 |
| 关系状态 | relation_status | ENUM | - | 待审核/已建立/已拒绝/已解除 | 师生关系状态 |

### 2.5 课程预约数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 预约ID | booking_id | INT | 11 | 自动生成 | 预约唯一标识 |
| 学员ID | student_id | INT | 11 | 外键关联 | 学员用户ID |
| 教练ID | coach_id | INT | 11 | 外键关联 | 教练用户ID |
| 校区ID | campus_id | INT | 11 | 外键关联 | 上课校区 |
| 球台ID | table_id | INT | 11 | 外键关联 | 球台编号 |
| 预约日期 | booking_date | DATE | - | YYYY-MM-DD | 上课日期 |
| 开始时间 | start_time | TIME | - | HH:MM:SS | 开始时间 |
| 结束时间 | end_time | TIME | - | HH:MM:SS | 结束时间 |
| 课时费 | lesson_fee | DECIMAL | 10,2 | 正数 | 本次课时费 |
| 预约状态 | booking_status | ENUM | - | 待确认/已确认/已取消/已完成 | 预约状态 |
| 创建时间 | create_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 预约创建时间 |
| 确认时间 | confirm_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 教练确认时间 |

### 2.6 球台信息数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 球台ID | table_id | INT | 11 | 自动生成 | 球台唯一标识 |
| 球台编号 | table_number | VARCHAR | 10 | 编号格式 | 球台编号 |
| 校区ID | campus_id | INT | 11 | 外键关联 | 所属校区 |
| 球台状态 | table_status | ENUM | - | 可用/维修中/已预约 | 球台状态 |

### 2.7 账户信息数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 账户ID | account_id | INT | 11 | 自动生成 | 账户唯一标识 |
| 用户ID | user_id | INT | 11 | 外键关联 | 关联用户 |
| 账户余额 | balance | DECIMAL | 10,2 | >=0 | 账户余额 |
| 最后更新时间 | last_update | DATETIME | - | YYYY-MM-DD HH:MM:SS | 余额最后更新时间 |

### 2.8 交易记录数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 交易ID | transaction_id | INT | 11 | 自动生成 | 交易唯一标识 |
| 用户ID | user_id | INT | 11 | 外键关联 | 交易用户 |
| 交易类型 | transaction_type | ENUM | - | 充值/扣费/退费 | 交易类型 |
| 交易金额 | amount | DECIMAL | 10,2 | 正数 | 交易金额 |
| 支付方式 | payment_method | ENUM | - | 微信/支付宝/线下 | 支付方式 |
| 交易状态 | transaction_status | ENUM | - | 成功/失败/处理中 | 交易状态 |
| 交易时间 | transaction_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 交易时间 |
| 关联预约ID | related_booking_id | INT | 11 | 外键关联 | 关联的预约ID（如有） |
| 第三方交易号 | external_transaction_id | VARCHAR | 100 | 文本 | 第三方支付平台交易号 |

### 2.9 比赛相关数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 比赛ID | match_id | INT | 11 | 自动生成 | 比赛唯一标识 |
| 比赛名称 | match_name | VARCHAR | 100 | 文本 | 比赛名称 |
| 比赛日期 | match_date | DATE | - | YYYY-MM-DD | 比赛日期 |
| 报名开始时间 | registration_start | DATETIME | - | YYYY-MM-DD HH:MM:SS | 报名开始时间 |
| 报名结束时间 | registration_end | DATETIME | - | YYYY-MM-DD HH:MM:SS | 报名结束时间 |
| 报名费 | registration_fee | DECIMAL | 10,2 | 正数 | 报名费用 |
| 比赛状态 | match_status | ENUM | - | 报名中/已开始/已结束 | 比赛状态 |

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 报名ID | registration_id | INT | 11 | 自动生成 | 报名记录唯一标识 |
| 比赛ID | match_id | INT | 11 | 外键关联 | 比赛ID |
| 学员ID | student_id | INT | 11 | 外键关联 | 参赛学员ID |
| 分组 | group_name | ENUM | - | 甲组/乙组/丙组 | 比赛分组 |
| 报名时间 | registration_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 报名时间 |
| 缴费状态 | payment_status | ENUM | - | 已缴费/未缴费 | 缴费状态 |

### 2.10 评价信息数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 评价ID | evaluation_id | INT | 11 | 自动生成 | 评价唯一标识 |
| 预约ID | booking_id | INT | 11 | 外键关联 | 关联预约ID |
| 评价者ID | evaluator_id | INT | 11 | 外键关联 | 评价者用户ID |
| 被评价者ID | evaluated_id | INT | 11 | 外键关联 | 被评价者用户ID |
| 评价类型 | evaluation_type | ENUM | - | 学员评价教练/教练评价学员 | 评价类型 |
| 评价内容 | content | TEXT | - | 文本 | 评价内容 |
| 评价时间 | evaluation_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 评价时间 |

### 2.11 系统日志数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 日志ID | log_id | INT | 11 | 自动生成 | 日志唯一标识 |
| 用户ID | user_id | INT | 11 | 外键关联 | 操作用户ID |
| 操作类型 | operation_type | VARCHAR | 50 | 文本 | 操作类型 |
| 操作内容 | operation_content | TEXT | - | 文本 | 操作详细内容 |
| 操作时间 | operation_time | DATETIME | - | YYYY-MM-DD HH:MM:SS | 操作时间 |
| IP地址 | ip_address | VARCHAR | 45 | IP格式 | 操作IP地址 |

### 2.12 取消预约限制数据项

| 数据项名称 | 别名 | 数据类型 | 长度 | 取值范围/格式 | 说明 |
|-----------|------|----------|------|---------------|------|
| 限制ID | cancellation_limit_id | INT | 11 | 自动生成 | 限制记录唯一标识 |
| 用户ID | user_id | INT | 11 | 外键关联 | 用户ID |
| 年月 | year_month | VARCHAR | 7 | YYYY-MM | 统计年月 |
| 取消次数 | cancellation_count | INT | 2 | 0-3 | 当月取消次数 |

## 3. 数据结构定义

### 3.1 用户信息结构

```
用户信息 = 用户ID + 用户名 + 密码 + 真实姓名 + 性别 + 年龄 +
          电话 + 邮箱 + 用户类型 + 校区ID + 注册时间 + 状态
```

### 3.2 教练员信息结构

```
教练员信息 = 用户信息 + 教练级别 + 每小时收费 + 照片路径 +
           成绩描述 + 最大学员数 + 当前学员数
```

### 3.3 课程预约结构

```
课程预约 = 预约ID + 学员ID + 教练ID + 校区ID + 球台ID +
          预约日期 + 开始时间 + 结束时间 + 课时费 +
          预约状态 + 创建时间 + 确认时间
```

### 3.4 比赛信息结构

```
比赛信息 = 比赛ID + 比赛名称 + 比赛日期 + 报名开始时间 +
          报名结束时间 + 报名费 + 比赛状态
```

## 4. 数据流定义

### 4.1 用户注册数据流

```
用户注册信息 = 用户名 + 密码 + 真实姓名 + 性别 + 年龄 +
              校区ID + 电话 + 邮箱 + [照片路径] + [成绩描述]
```

### 4.2 课程预约数据流

```
预约申请信息 = 学员ID + 教练ID + 预约日期 + 开始时间 +
              结束时间 + 球台选择偏好

预约确认信息 = 预约ID + 确认状态 + 确认时间
```

### 4.3 支付信息数据流

```
充值信息 = 用户ID + 充值金额 + 支付方式

扣费信息 = 用户ID + 扣费金额 + 关联预约ID + 交易类型
```

## 5. 数据存储定义

### 5.1 D1: 用户信息表
- **内容**: 所有系统用户的基本信息
- **组织方式**: 以用户ID为主键的关系表
- **访问方式**: 用户名、电话、邮箱索引查询

### 5.2 D3: 师生关系表
- **内容**: 学员与教练的选择关系记录
- **组织方式**: 以关系ID为主键，学员ID和教练ID为外键
- **访问方式**: 按学员ID或教练ID查询

### 5.3 D4: 预约信息表
- **内容**: 所有课程预约记录
- **组织方式**: 以预约ID为主键的关系表
- **访问方式**: 按日期、教练ID、学员ID查询

### 5.4 D7: 交易记录表
- **内容**: 所有财务交易记录
- **组织方式**: 以交易ID为主键的关系表
- **访问方式**: 按用户ID、交易时间查询

## 6. 处理过程定义

### 6.1 P1: 用户管理
- **输入**: 用户注册信息、登录信息、修改信息
- **处理**: 验证信息格式、检查重复、权限验证
- **输出**: 处理结果、用户状态

### 6.2 P3: 课程预约管理
- **输入**: 预约申请信息、取消申请信息
- **处理**: 检查师生关系、验证时间冲突、计算费用
- **输出**: 预约状态、课表更新

### 6.3 P4: 收费管理
- **输入**: 充值请求、扣费请求
- **处理**: 调用第三方支付、更新账户余额、记录交易
- **输出**: 交易结果、余额信息

## 7. 约束条件

### 7.1 数据完整性约束
- 用户名必须唯一
- 电话号码格式验证
- 邮箱格式验证
- 密码强度验证

### 7.2 业务规则约束
- 学员最多选择2个教练
- 教练最多指导20名学员
- 每月取消预约不超过3次
- 预约取消需24小时前提交

### 7.3 引用完整性约束
- 所有外键必须引用存在的主键
- 删除时需检查关联关系
- 级联更新相关信息