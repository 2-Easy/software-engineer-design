# 乒乓球培训管理系统 - 数据流图设计

## 1. 系统背景分析

乒乓球培训管理系统是一个面向培训机构的综合管理平台，主要涉及用户管理、课程预约、收费管理、比赛组织等核心业务流程。

## 2. 外部实体识别

- **学员**: 参加乒乓球培训的用户
- **教练员**: 提供培训服务的教练
- **校区管理员**: 管理特定校区的管理员
- **超级管理员**: 管理整个系统和多个校区
- **支付平台**: 微信、支付宝等第三方支付系统
- **系统管理员**: 维护系统运行的技术人员

## 3. 顶层数据流图 (DFD Level 0)

```
                    乒乓球培训管理系统
                           |
    学员信息 ←→ [学员] ←→ 预约信息、评价信息
                           |
    教练信息 ←→ [教练员] ←→ 课表信息、评价信息
                           |
    管理信息 ←→ [校区管理员] ←→ 审核信息、统计信息
                           |
    系统配置 ←→ [超级管理员] ←→ 校区信息、权限信息
                           |
    支付信息 ←→ [支付平台] ←→ 交易结果
                           |
    日志信息 ←→ [系统管理员] ←→ 系统状态
```

## 4. 一级数据流图 (DFD Level 1)

### 主要处理过程：

1. **用户管理 (P1)**
   - 输入：注册信息、登录信息、修改信息
   - 输出：用户状态、用户信息
   - 数据存储：用户信息表

2. **教练选择管理 (P2)**
   - 输入：查询条件、选择申请
   - 输出：教练列表、选择结果
   - 数据存储：教练信息表、师生关系表

3. **课程预约管理 (P3)**
   - 输入：预约申请、取消申请
   - 输出：预约结果、课表信息
   - 数据存储：预约信息表、球台信息表

4. **收费管理 (P4)**
   - 输入：充值请求、扣费请求
   - 输出：账户余额、交易记录
   - 数据存储：账户信息表、交易记录表

5. **比赛管理 (P5)**
   - 输入：报名信息、比赛结果
   - 输出：赛程安排、比赛结果
   - 数据存储：比赛信息表、赛程表

6. **评价管理 (P6)**
   - 输入：评价内容
   - 输出：评价结果、统计信息
   - 数据存储：评价信息表

7. **系统日志管理 (P7)**
   - 输入：操作记录
   - 输出：日志报告
   - 数据存储：系统日志表

### 数据存储：

- **D1: 用户信息表** - 存储学员、教练员、管理员基本信息
- **D2: 校区信息表** - 存储各校区基本信息
- **D3: 师生关系表** - 存储学员与教练的选择关系
- **D4: 预约信息表** - 存储课程预约记录
- **D5: 球台信息表** - 存储球台基本信息和使用状态
- **D6: 账户信息表** - 存储用户账户余额信息
- **D7: 交易记录表** - 存储所有收费和退费记录
- **D8: 比赛信息表** - 存储比赛基本信息
- **D9: 评价信息表** - 存储课后评价内容
- **D10: 系统日志表** - 存储系统操作日志

## 5. 二级数据流图 (DFD Level 2)

### P1 用户管理细化：

- **P1.1 用户注册**
  - 输入：注册表单
  - 输出：注册结果
  - 验证：密码格式、信息完整性

- **P1.2 用户登录**
  - 输入：登录凭证
  - 输出：登录状态、用户权限

- **P1.3 信息维护**
  - 输入：修改信息
  - 输出：更新结果

- **P1.4 权限管理**
  - 输入：权限分配请求
  - 输出：权限状态

### P3 课程预约管理细化：

- **P3.1 课表查询**
  - 输入：教练ID、时间范围
  - 输出：可用时间段、球台信息

- **P3.2 预约申请**
  - 输入：预约详情
  - 输出：预约申请状态

- **P3.3 预约确认**
  - 输入：确认/拒绝决定
  - 输出：最终预约状态

- **P3.4 预约取消**
  - 输入：取消申请
  - 输出：取消结果、退费信息

## 6. 数据流详细说明

### 主要数据流：

1. **用户注册信息流**
   - 学员/教练填写注册表单 → 系统验证 → 存储用户信息

2. **教练选择信息流**
   - 学员查询教练 → 系统返回教练列表 → 学员选择 → 教练确认 → 建立师生关系

3. **课程预约信息流**
   - 学员查看课表 → 选择时间段 → 提交预约 → 教练确认 → 扣费 → 预约成功

4. **收费信息流**
   - 用户充值 → 第三方支付 → 更新账户余额
   - 课程扣费 → 检查余额 → 扣除费用 → 更新余额

5. **比赛管理信息流**
   - 学员报名 → 缴费 → 系统排程 → 生成赛程表 → 比赛结果录入

## 7. 系统边界和约束

### 系统边界：
- 处理培训机构内部管理流程
- 集成第三方支付平台
- 不包含硬件设备管理

### 主要约束：
- 学员最多选择2个教练
- 教练最多指导20名学员
- 每月取消预约不超过3次
- 24小时前才能取消预约
- 比赛报名费30元固定